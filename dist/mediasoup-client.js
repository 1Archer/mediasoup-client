/*
 * mediasoup-client v2.0.4
 * mediasoup client side JavaScript SDK
 * https://mediasoup.org
 * Copyright © 2017, Iñaki Baz Castillo <ibc@aliax.net>
 * License: ISC
 */

!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{("undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this).mediasoupClient=e()}}(function(){return function e(t,r,n){function o(i,s){if(!r[i]){if(!t[i]){var c="function"==typeof require&&require;if(!s&&c)return c(i,!0);if(a)return a(i,!0);var u=new Error("Cannot find module '"+i+"'");throw u.code="MODULE_NOT_FOUND",u}var d=r[i]={exports:{}};t[i][0].call(d.exports,function(e){var r=t[i][1][e];return o(r||e)},d,d.exports,e,t,r,n)}return r[i].exports}for(var a="function"==typeof require&&require,i=0;i<n.length;i++)o(n[i]);return o}({1:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=e("events"),c=function(e){return e&&e.__esModule?e:{default:e}}(e("./Logger")),u=e("./errors"),d=new c.default("CommandQueue"),l=function(e){function t(){n(this,t);var e=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e.setMaxListeners(1/0),e._closed=!1,e._busy=!1,e._queue=[],e}return a(t,s.EventEmitter),i(t,[{key:"close",value:function(){this._closed=!0}},{key:"push",value:function(e,t){var r=this,n=Object.assign({method:e},t);return d.debug("push() [method:%s]",e),new Promise(function(e,t){var o=r._queue;n.resolve=e,n.reject=t,o.push(n),r._handlePendingCommands()})}},{key:"_handlePendingCommands",value:function(){var e=this;if(!this._busy){var t=this._queue,r=t[0];r&&(this._busy=!0,this._handleCommand(r).then(function(){e._busy=!1,t.shift(),e._handlePendingCommands()}))}}},{key:"_handleCommand",value:function(e){var t=this;if(d.debug("_handleCommand() [method:%s]",e.method),this._closed)return e.reject(new u.InvalidStateError("closed")),Promise.resolve();var r={promise:null};return this.emit("exec",e,r),Promise.resolve().then(function(){return r.promise}).then(function(r){d.debug("_handleCommand() | command succeeded [method:%s]",e.method),t._closed?e.reject(new u.InvalidStateError("closed")):e.resolve(r)}).catch(function(t){d.error("_handleCommand() | command failed [method:%s]: %o",e.method,t),e.reject(t)})}}]),t}();r.default=l},{"./Logger":5,"./errors":10,events:27}],2:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=n(e("./Logger")),d=n(e("./EnhancedEventEmitter")),l=e("./errors"),p=new Set(["default","low","medium","high"]),f=1e3,m=new u.default("Consumer"),h=function(e){function t(e,r,n,i,s){o(this,t);var c=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,m));return c._id=e,c._closed=!1,c._kind=r,c._rtpParameters=n,c._peer=i,c._appData=s,c._supported=!1,c._transport=null,c._track=null,c._locallyPaused=!1,c._remotelyPaused=!1,c._statsEnabled=!1,c._statsInterval=f,c._preferredProfile="default",c._effectiveProfile=null,c}return i(t,d.default),c(t,[{key:"close",value:function(){m.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableConsumerStats(this)),this.emit("@close"),this.safeEmit("close","local"),this._destroy())}},{key:"remoteClose",value:function(){m.debug("remoteClose()"),this._closed||(this._closed=!0,this._transport&&this._transport.removeConsumer(this),this._destroy(),this.emit("@close"),this.safeEmit("close","remote"))}},{key:"_destroy",value:function(){this._transport=null;try{this._track.stop()}catch(e){}this._track=null}},{key:"receive",value:function(e){var t=this;return m.debug("receive() [transport:%o]",e),this._closed?Promise.reject(new l.InvalidStateError("Consumer closed")):this._supported?this._transport?Promise.reject(new Error("already handled by a Transport")):"object"!==(void 0===e?"undefined":s(e))?Promise.reject(new TypeError("invalid Transport")):(this._transport=e,e.addConsumer(this).then(function(r){return t._track=r,t.paused&&(r.enabled=!1),e.once("@close",function(){if(!t._closed&&t._transport===e){t._transport=null;try{t._track.stop()}catch(e){}t._track=null,t.safeEmit("unhandled")}}),t.safeEmit("handled"),t._statsEnabled&&e.enableConsumerStats(t,t._statsInterval),r}).catch(function(e){throw t._transport=null,e})):Promise.reject(new Error("unsupported codecs"))}},{key:"pause",value:function(e){return m.debug("pause()"),this._closed?(m.error("pause() | Consumer closed"),!1):!!this._locallyPaused||(this._locallyPaused=!0,this._track&&(this._track.enabled=!1),this._transport&&this._transport.pauseConsumer(this,e),this.safeEmit("pause","local",e),this.paused)}},{key:"remotePause",value:function(e){m.debug("remotePause()"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track&&(this._track.enabled=!1),this.safeEmit("pause","remote",e))}},{key:"resume",value:function(e){return m.debug("resume()"),this._closed?(m.error("resume() | Consumer closed"),!1):!this._locallyPaused||(this._locallyPaused=!1,this._track&&!this._remotelyPaused&&(this._track.enabled=!0),this._transport&&this._transport.resumeConsumer(this,e),this.safeEmit("resume","local",e),!this.paused)}},{key:"remoteResume",value:function(e){m.debug("remoteResume()"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._track&&!this._locallyPaused&&(this._track.enabled=!0),this.safeEmit("resume","remote",e))}},{key:"setPreferredProfile",value:function(e){m.debug("setPreferredProfile() [profile:%s]",e),this._closed?m.error("setPreferredProfile() | Consumer closed"):e!==this._preferredProfile&&(p.has(e)?(this._preferredProfile=e,this._transport&&this._transport.setConsumerPreferredProfile(this,this._preferredProfile)):m.error('setPreferredProfile() | invalid profile "%s"',e))}},{key:"remoteSetPreferredProfile",value:function(e){m.debug("remoteSetPreferredProfile() [profile:%s]",e),this._closed||e===this._preferredProfile||(this._preferredProfile=e)}},{key:"remoteEffectiveProfileChanged",value:function(e){m.debug("remoteEffectiveProfileChanged() [profile:%s]",e),this._closed||e===this._effectiveProfile||(this._effectiveProfile=e,this.safeEmit("effectiveprofilechange",this._effectiveProfile))}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;m.debug("enableStats() [interval:%s]",e),this._closed?m.error("enableStats() | Consumer closed"):this._statsEnabled||(this._statsInterval="number"!=typeof e||e<1e3?f:e,this._statsEnabled=!0,this._transport&&this._transport.enableConsumerStats(this,this._statsInterval))}},{key:"disableStats",value:function(){m.debug("disableStats()"),this._closed?m.error("disableStats() | Consumer closed"):this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableConsumerStats(this))}},{key:"setSupported",value:function(e){this._supported=e}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._kind}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"peer",get:function(){return this._peer}},{key:"appData",get:function(){return this._appData}},{key:"supported",get:function(){return this._supported}},{key:"transport",get:function(){return this._transport}},{key:"track",get:function(){return this._track}},{key:"locallyPaused",get:function(){return this._locallyPaused}},{key:"remotelyPaused",get:function(){return this._remotelyPaused}},{key:"paused",get:function(){return this._locallyPaused||this._remotelyPaused}},{key:"preferredProfile",get:function(){return this._preferredProfile}},{key:"effectiveProfile",get:function(){return this._effectiveProfile}}]),t}();r.default=h},{"./EnhancedEventEmitter":4,"./Logger":5,"./errors":10}],3:[function(e,t,r){(function(t){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var a=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),i=n(e("bowser")),s=n(e("./Logger")),c=n(e("./handlers/Chrome55")),u=n(e("./handlers/Safari11")),d=n(e("./handlers/Firefox50")),l=n(e("./handlers/Edge11")),p=new s.default("Device"),f=function(){function e(){o(this,e)}return a(e,null,[{key:"isSupported",value:function(){return e._detected||e._detect(),Boolean(e._handlerClass)}},{key:"_detect",value:function(){var r=t.navigator.userAgent,n=i.default._detect(r);e._detected=!0,e._flag=void 0,e._name=n.name||"unknown device",e._version=n.version||"unknown vesion",e._bowser=n,e._handlerClass=null,i.default.check({chrome:"55",chromium:"55"},!0,r)?(e._flag="chrome",e._handlerClass=c.default):i.default.check({firefox:"50"},!0,r)?(e._flag="firefox",e._handlerClass=d.default):i.default.check({safari:"11"},!0,r)?(e._flag="safari",e._handlerClass=u.default):i.default.check({msedge:"11"},!0,r)&&(e._flag="msedge",e._handlerClass=l.default),i.default.check({opera:"44"},!0,r)&&(e._flag="opera",e._handlerClass=c.default),e.isSupported()?p.debug('device supported [flag:%s, name:"%s", version:%s, handler:%s]',e._flag,e._name,e._version,e._handlerClass.name):p.warn("device not supported [name:%s, version:%s]",e._name,e._version)}},{key:"flag",get:function(){return e._detected||e._detect(),e._flag}},{key:"name",get:function(){return e._detected||e._detect(),e._name}},{key:"version",get:function(){return e._detected||e._detect(),e._version}},{key:"bowser",get:function(){return e._detected||e._detect(),e._bowser}},{key:"Handler",get:function(){return e._detected||e._detect(),e._handlerClass}}]),e}();r.default=f,f._detected=!1,f._flag=void 0,f._name=void 0,f._version=void 0,f._bowser=void 0,f._handlerClass=null}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Logger":5,"./handlers/Chrome55":11,"./handlers/Edge11":12,"./handlers/Firefox50":13,"./handlers/Safari11":14,bowser:24}],4:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var i=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),s=e("events"),c=function(e){return e&&e.__esModule?e:{default:e}}(e("./Logger")),u=function(e){function t(e){n(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return r.setMaxListeners(1/0),r._logger=e||new c.default("EnhancedEventEmitter"),r}return a(t,s.EventEmitter),i(t,[{key:"safeEmit",value:function(e){try{for(var t=arguments.length,r=Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];this.emit.apply(this,[e].concat(r))}catch(t){this._logger.error("safeEmit() | event listener threw an error [event:%s]:%o",e,t)}}},{key:"safeEmitAsPromise",value:function(e){for(var t=this,r=arguments.length,n=Array(r>1?r-1:0),o=1;o<r;o++)n[o-1]=arguments[o];return new Promise(function(r,o){t.safeEmit.apply(t,[e].concat(n,[function(e){r(e)},function(r){t._logger.error("safeEmitAsPromise() | errback called [event:%s]:%o",e,r),o(r)}]))})}}]),t}();r.default=u},{"./Logger":5,events:27}],5:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var o=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),a=function(e){return e&&e.__esModule?e:{default:e}}(e("debug")),i="mediasoup-client",s=function(){function e(t){n(this,e),t?(this._debug=(0,a.default)(i+":"+t),this._warn=(0,a.default)(i+":WARN:"+t),this._error=(0,a.default)(i+":ERROR:"+t)):(this._debug=(0,a.default)(i),this._warn=(0,a.default)(i+":WARN"),this._error=(0,a.default)(i+":ERROR")),this._debug.log=console.info.bind(console),this._warn.log=console.warn.bind(console),this._error.log=console.error.bind(console)}return o(e,[{key:"debug",get:function(){return this._debug}},{key:"warn",get:function(){return this._warn}},{key:"error",get:function(){return this._error}}]),e}();r.default=s},{debug:25}],6:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=n(e("./Logger")),u=n(e("./EnhancedEventEmitter")),d=new c.default("Peer"),l=function(e){function t(e,r){o(this,t);var n=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,d));return n._name=e,n._closed=!1,n._appData=r,n._consumers=new Map,n}return i(t,u.default),s(t,[{key:"close",value:function(){if(d.debug("close()"),!this._closed){this._closed=!0,this.emit("@close"),this.safeEmit("close","local");var e=!0,t=!1,r=void 0;try{for(var n,o=this._consumers.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0)n.value.close()}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}}}},{key:"remoteClose",value:function(e){if(d.debug("remoteClose()"),!this._closed){this._closed=!0,this.emit("@close"),this.safeEmit("close","remote",e);var t=!0,r=!1,n=void 0;try{for(var o,a=this._consumers.values()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0)o.value.remoteClose()}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}}}},{key:"getConsumerById",value:function(e){return this._consumers.get(e)}},{key:"addConsumer",value:function(e){var t=this;if(this._consumers.has(e.id))throw new Error("Consumer already exists [id:"+e.id+"]");this._consumers.set(e.id,e),e.on("@close",function(){t._consumers.delete(e.id)}),this.safeEmit("newconsumer",e)}},{key:"name",get:function(){return this._name}},{key:"closed",get:function(){return this._closed}},{key:"appData",get:function(){return this._appData}},{key:"consumers",get:function(){return Array.from(this._consumers.values())}}]),t}();r.default=l},{"./EnhancedEventEmitter":4,"./Logger":5}],7:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=n(e("./Logger")),d=n(e("./EnhancedEventEmitter")),l=e("./errors"),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("./utils")),f=1e3,m={low:1e5,medium:3e5,high:15e5},h=new u.default("Producer"),v=function(e){function t(e,r,n){o(this,t);var i=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,h));return i._id=p.randomNumber(),i._closed=!1,i._originalTrack=e,i._track=e.clone(),i._appData=n,i._simulcast=!1,r.simulcast&&(i._simulcast=Object.assign({},m,r.simulcast)),i._transport=null,i._rtpParameters=null,i._locallyPaused=!i._track.enabled,i._remotelyPaused=!1,i._statsEnabled=!1,i._statsInterval=f,i._handleTrack(),i}return i(t,d.default),c(t,[{key:"close",value:function(e){h.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.transport&&this.transport.disableProducerStats(this)),this._transport&&this._transport.removeProducer(this,"local",e),this._destroy(),this.emit("@close","local",e),this.safeEmit("close","local",e))}},{key:"remoteClose",value:function(e){h.debug("remoteClose()"),this._closed||(this._closed=!0,this._transport&&this._transport.removeProducer(this,"remote",e),this._destroy(),this.emit("@close","remote",e),this.safeEmit("close","remote",e))}},{key:"_destroy",value:function(){this._transport=!1,this._rtpParameters=null;try{this._track.stop()}catch(e){}}},{key:"send",value:function(e){var t=this;return h.debug("send() [transport:%o]",e),this._closed?Promise.reject(new l.InvalidStateError("Producer closed")):this._transport?Promise.reject(new Error("already handled by a Transport")):"object"!==(void 0===e?"undefined":s(e))?Promise.reject(new TypeError("invalid Transport")):(this._transport=e,e.addProducer(this).then(function(){e.once("@close",function(){t._closed||t._transport!==e||(t._transport.removeProducer(t,"local"),t._transport=null,t._rtpParameters=null,t.safeEmit("unhandled"))}),t.safeEmit("handled"),t._statsEnabled&&e.enableProducerStats(t,t._statsInterval)}).catch(function(e){throw t._transport=null,e}))}},{key:"pause",value:function(e){return h.debug("pause()"),this._closed?(h.error("pause() | Producer closed"),!1):!!this._locallyPaused||(this._locallyPaused=!0,this._track.enabled=!1,this._transport&&this._transport.pauseProducer(this,e),this.safeEmit("pause","local",e),this.paused)}},{key:"remotePause",value:function(e){h.debug("remotePause()"),this._closed||this._remotelyPaused||(this._remotelyPaused=!0,this._track.enabled=!1,this.safeEmit("pause","remote",e))}},{key:"resume",value:function(e){return h.debug("resume()"),this._closed?(h.error("resume() | Producer closed"),!1):!this._locallyPaused||(this._locallyPaused=!1,this._remotelyPaused||(this._track.enabled=!0),this._transport&&this._transport.resumeProducer(this,e),this.safeEmit("resume","local",e),!this.paused)}},{key:"remoteResume",value:function(e){h.debug("remoteResume()"),!this._closed&&this._remotelyPaused&&(this._remotelyPaused=!1,this._locallyPaused||(this._track.enabled=!0),this.safeEmit("resume","remote",e))}},{key:"replaceTrack",value:function(e){var t=this;if(h.debug("replaceTrack() [track:%o]",e),this._closed)return Promise.reject(new l.InvalidStateError("Producer closed"));if(!(e instanceof MediaStreamTrack))return Promise.reject(new TypeError("track is not a MediaStreamTrack"));if("ended"===e.readyState)return Promise.reject(new Error('track.readyState is "ended"'));var r=e.clone();return Promise.resolve().then(function(){if(t._transport)return t._transport.replaceProducerTrack(t,r)}).then(function(){try{t._track.onended=null,t._track.stop()}catch(e){}return t.paused?r.enabled=!1:r.enabled=!0,t._originalTrack=e,t._track=r,t._handleTrack(),t._track})}},{key:"setRtpParameters",value:function(e){this._rtpParameters=e}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:f;h.debug("enableStats() [interval:%s]",e),this._closed?h.error("enableStats() | Producer closed"):this._statsEnabled||(this._statsInterval="number"!=typeof e||e<1e3?f:e,this._statsEnabled=!0,this._transport&&this._transport.enableProducerStats(this,this._statsInterval))}},{key:"disableStats",value:function(){h.debug("disableStats()"),this._closed?h.error("disableStats() | Producer closed"):this._statsEnabled&&(this._statsEnabled=!1,this._transport&&this._transport.disableProducerStats(this))}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"_handleTrack",value:function(){var e=this;this._track.onended=function(){e._closed||(h.warn('track "ended" event, closing Producer'),e.safeEmit("trackended"),e.close())}}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"kind",get:function(){return this._track.kind}},{key:"track",get:function(){return this._track}},{key:"originalTrack",get:function(){return this._originalTrack}},{key:"simulcast",get:function(){return this._simulcast}},{key:"appData",get:function(){return this._appData}},{key:"transport",get:function(){return this._transport}},{key:"rtpParameters",get:function(){return this._rtpParameters}},{key:"locallyPaused",get:function(){return this._locallyPaused}},{key:"remotelyPaused",get:function(){return this._remotelyPaused}},{key:"paused",get:function(){return this._locallyPaused||this._remotelyPaused}}]),t}();r.default=v},{"./EnhancedEventEmitter":4,"./Logger":5,"./errors":10,"./utils":23}],8:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=n(e("./Logger")),d=n(e("./EnhancedEventEmitter")),l=e("./errors"),p=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("./ortc")),f=n(e("./Device")),m=n(e("./Transport")),h=n(e("./Producer")),v=n(e("./Peer")),y=n(e("./Consumer")),_=new u.default("Room"),g={new:"new",joining:"joining",joined:"joined",closed:"closed"},b=function(e){function t(e){o(this,t);var r=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,_));if(_.debug("constructor() [options:%o]",e),!f.default.isSupported())throw new Error("current browser/device not supported");return e=e||{},r._settings={roomSettings:e.roomSettings,requestTimeout:e.requestTimeout||1e4,transportOptions:e.transportOptions||{},turnServers:e.turnServers||[]},r._state=g.new,r._peerName=null,r._transports=new Map,r._producers=new Map,r._peers=new Map,r._extendedRtpCapabilities=null,r._canSendByKind={audio:!1,video:!1},r}return i(t,d.default),c(t,[{key:"getTransportById",value:function(e){return this._transports.get(e)}},{key:"getProducerById",value:function(e){return this._producers.get(e)}},{key:"getPeerByName",value:function(e){return this._peers.get(e)}},{key:"join",value:function(e,t){var r=this;if(_.debug('join() [peerName:"%s"]',e),"string"!=typeof e)return Promise.reject(new TypeError("invalid peerName"));if(this._state!==g.new&&this._state!==g.closed)return Promise.reject(new l.InvalidStateError('invalid state "'+this._state+'"'));this._peerName=e,this._state=g.joining;var n=void 0;return Promise.resolve().then(function(){return r._settings.roomSettings?void(n=r._settings.roomSettings):r._sendRequest("queryRoom",{target:"room"}).then(function(e){n=e,_.debug("join() | got Room settings:%o",n)})}).then(function(){return f.default.Handler.getNativeRtpCapabilities()}).then(function(e){_.debug("join() | native RTP capabilities:%o",e),r._extendedRtpCapabilities=p.getExtendedRtpCapabilities(e,n.rtpCapabilities),_.debug("join() | extended RTP capabilities:%o",r._extendedRtpCapabilities);var o=p.getUnsupportedCodecs(n.rtpCapabilities,n.mandatoryCodecPayloadTypes,r._extendedRtpCapabilities);if(o.length>0)throw _.error("%s mandatory room codecs not supported:%o",o.length,o),new l.UnsupportedError("mandatory room codecs not supported",o);r._canSendByKind.audio=p.canSend("audio",r._extendedRtpCapabilities),r._canSendByKind.video=p.canSend("video",r._extendedRtpCapabilities);var a=p.getRtpCapabilities(r._extendedRtpCapabilities);_.debug("join() | effective local RTP capabilities for receiving:%o",a);var i={target:"room",peerName:r._peerName,rtpCapabilities:a,appData:t};return r._sendRequest("join",i).then(function(e){return e.peers})}).then(function(e){var t=!0,n=!1,o=void 0;try{for(var a,i=(e||[])[Symbol.iterator]();!(t=(a=i.next()).done);t=!0){var s=a.value;try{r._handlePeerData(s)}catch(e){_.error("join() | error handling Peer:%o",e)}}}catch(e){n=!0,o=e}finally{try{!t&&i.return&&i.return()}finally{if(n)throw o}}return r._state=g.joined,_.debug("join() | joined the Room"),r.peers}).catch(function(e){throw r._state=g.new,e})}},{key:"leave",value:function(e){if(_.debug("leave()"),!this.closed){this._sendNotification("leave",{appData:e}),this._state=g.closed,this.safeEmit("close","local",e);var t=!0,r=!1,n=void 0;try{for(var o,a=this._transports.values()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0)o.value.close()}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}var i=!0,s=!1,c=void 0;try{for(var u,d=this._producers.values()[Symbol.iterator]();!(i=(u=d.next()).done);i=!0)u.value.close()}catch(e){s=!0,c=e}finally{try{!i&&d.return&&d.return()}finally{if(s)throw c}}var l=!0,p=!1,f=void 0;try{for(var m,h=this._peers.values()[Symbol.iterator]();!(l=(m=h.next()).done);l=!0)m.value.close()}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}}}},{key:"remoteClose",value:function(e){if(_.debug("remoteClose()"),!this.closed){this._state=g.closed,this.safeEmit("close","remote",e);var t=!0,r=!1,n=void 0;try{for(var o,a=this._transports.values()[Symbol.iterator]();!(t=(o=a.next()).done);t=!0)o.value.remoteClose()}catch(e){r=!0,n=e}finally{try{!t&&a.return&&a.return()}finally{if(r)throw n}}var i=!0,s=!1,c=void 0;try{for(var u,d=this._producers.values()[Symbol.iterator]();!(i=(u=d.next()).done);i=!0)u.value.remoteClose()}catch(e){s=!0,c=e}finally{try{!i&&d.return&&d.return()}finally{if(s)throw c}}var l=!0,p=!1,f=void 0;try{for(var m,h=this._peers.values()[Symbol.iterator]();!(l=(m=h.next()).done);l=!0)m.value.remoteClose()}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}}}},{key:"canSend",value:function(e){if(!this.joined)throw new l.InvalidStateError('invalid state "'+this._state+'"');if("audio"!==e&&"video"!==e)throw new TypeError('invalid kind "'+e+'"');return this._canSendByKind[e]}},{key:"createTransport",value:function(e,t){var r=this;if(_.debug("createTransport() [direction:%s]",e),!this.joined)throw new l.InvalidStateError('invalid state "'+this._state+'"');if("send"!==e&&"recv"!==e)throw new TypeError('invalid direction "'+e+'"');var n=new m.default(e,this._extendedRtpCapabilities,this._settings,t);return this._transports.set(n.id,n),n.on("@request",function(e,t,n,o){r._sendRequest(e,t).then(n).catch(o)}),n.on("@notify",function(e,t){r._sendNotification(e,t)}),n.on("@close",function(){r._transports.delete(n.id)}),n}},{key:"createProducer",value:function(e,t,r){var n=this;if(_.debug("createProducer() [track:%o, options:%o]",e,t),!this.joined)throw new l.InvalidStateError('invalid state "'+this._state+'"');if(!(e instanceof MediaStreamTrack))throw new TypeError("track is not a MediaStreamTrack");if(!this._canSendByKind[e.kind])throw new Error("cannot send "+e.kind);if("ended"===e.readyState)throw new Error('track.readyState is "ended"');t=t||{};var o=new h.default(e,t,r);return this._producers.set(o.id,o),o.on("@close",function(){n._producers.delete(o.id)}),o}},{key:"restartIce",value:function(){if(!this.joined)throw new l.InvalidStateError('invalid state "'+this._state+'"');var e=!0,t=!1,r=void 0;try{for(var n,o=this._transports.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0)n.value.restartIce()}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}}},{key:"receiveNotification",value:function(e){var t=this;if(this.closed)return Promise.reject(new l.InvalidStateError("Room closed"));if("object"!==(void 0===e?"undefined":s(e)))return Promise.reject(new TypeError("wrong notification Object"));if(!0!==e.notification)return Promise.reject(new TypeError("not a notification"));if("string"!=typeof e.method)return Promise.reject(new TypeError("wrong/missing notification method"));var r=e.method;return _.debug("receiveNotification() [method:%s, notification:%o]",r,e),Promise.resolve().then(function(){switch(r){case"closed":var n=e.appData;t.remoteClose(n);break;case"transportClosed":var o=e.id,a=e.appData,i=t._transports.get(o);if(!i)throw new Error('Transport not found [id:"'+o+'"]');i.remoteClose(a);break;case"transportStats":var s=e.id,c=e.stats,u=t._transports.get(s);if(!u)throw new Error("transport not found [id:"+s+"]");u.remoteStats(c);break;case"newPeer":var d=e.name;if(t._peers.has(d))throw new Error('Peer already exists [name:"'+d+'"]');var l=e;t._handlePeerData(l);break;case"peerClosed":var p=e.name,f=e.appData,m=t._peers.get(p);if(!m)throw new Error('no Peer found [name:"'+p+'"]');m.remoteClose(f);break;case"producerPaused":var h=e.id,v=e.appData,y=t._producers.get(h);if(!y)throw new Error("Producer not found [id:"+h+"]");y.remotePause(v);break;case"producerResumed":var _=e.id,g=e.appData,b=t._producers.get(_);if(!b)throw new Error("Producer not found [id:"+_+"]");b.remoteResume(g);break;case"producerClosed":var w=e.id,P=e.appData,k=t._producers.get(w);if(!k)throw new Error("Producer not found [id:"+w+"]");k.remoteClose(P);break;case"producerStats":var S=e.id,C=e.stats,T=t._producers.get(S);if(!T)throw new Error("Producer not found [id:"+S+"]");T.remoteStats(C);break;case"newConsumer":var E=e.peerName,x=t._peers.get(E);if(!x)throw new Error('no Peer found [name:"'+E+'"]');var R=e;t._handleConsumerData(R,x);break;case"consumerClosed":var O=e.id,j=e.peerName,I=e.appData,D=t._peers.get(j);if(!D)throw new Error('no Peer found [name:"'+j+'"]');var F=D.getConsumerById(O);if(!F)throw new Error("Consumer not found [id:"+O+"]");F.remoteClose(I);break;case"consumerPaused":var L=e.id,M=e.peerName,A=e.appData,N=t._peers.get(M);if(!N)throw new Error('no Peer found [name:"'+M+'"]');var B=N.getConsumerById(L);if(!B)throw new Error("Consumer not found [id:"+L+"]");B.remotePause(A);break;case"consumerResumed":var U=e.id,G=e.peerName,z=e.appData,q=t._peers.get(G);if(!q)throw new Error('no Peer found [name:"'+G+'"]');var K=q.getConsumerById(U);if(!K)throw new Error("Consumer not found [id:"+U+"]");K.remoteResume(z);break;case"consumerPreferredProfileSet":var V=e.id,W=e.peerName,Q=e.profile,$=t._peers.get(W);if(!$)throw new Error('no Peer found [name:"'+W+'"]');var J=$.getConsumerById(V);if(!J)throw new Error("Consumer not found [id:"+V+"]");J.remoteSetPreferredProfile(Q);break;case"consumerEffectiveProfileChanged":var X=e.id,H=e.peerName,Z=e.profile,Y=t._peers.get(H);if(!Y)throw new Error('no Peer found [name:"'+H+'"]');var ee=Y.getConsumerById(X);if(!ee)throw new Error("Consumer not found [id:"+X+"]");ee.remoteEffectiveProfileChanged(Z);break;case"consumerStats":var te=e.id,re=e.peerName,ne=e.stats,oe=t._peers.get(re);if(!oe)throw new Error('no Peer found [name:"'+re+'"]');var ae=oe.getConsumerById(te);if(!ae)throw new Error("Consumer not found [id:"+te+"]");ae.remoteStats(ne);break;default:throw new Error('unknown notification method "'+r+'"')}}).catch(function(t){_.error("receiveNotification() failed [notification:%o]: %s",e,t)})}},{key:"_sendRequest",value:function(e,t){var r=this,n=Object.assign({method:e,target:"peer"},t);return this.closed?(_.error("_sendRequest() | Room closed [method:%s, request:%o]",e,n),Promise.reject(new l.InvalidStateError("Room closed"))):(_.debug("_sendRequest() [method:%s, request:%o]",e,n),new Promise(function(t,o){var a=!1,i=setTimeout(function(){_.error("request failed [method:%s]: timeout",e),a=!0,o(new l.TimeoutError("timeout"))},r._settings.requestTimeout);r.safeEmit("request",n,function(n){if(!a){if(a=!0,clearTimeout(i),r.closed)return _.error("request failed [method:%s]: Room closed",e),void o(new Error("Room closed"));_.debug("request succeeded [method:%s, response:%o]",e,n),t(n)}},function(t){if(!a){if(a=!0,clearTimeout(i),r.closed)return _.error("request failed [method:%s]: Room closed",e),void o(new Error("Room closed"));t instanceof Error||(t=new Error(String(t))),_.error("request failed [method:%s]:%o",e,t),o(t)}})}))}},{key:"_sendNotification",value:function(e,t){if(!this.closed){var r=Object.assign({method:e,target:"peer",notification:!0},t);_.debug("_sendNotification() [method:%s, notification:%o]",e,r),this.safeEmit("notify",r)}}},{key:"_handlePeerData",value:function(e){var t=this,r=e.name,n=e.consumers,o=e.appData,a=new v.default(r,o);this._peers.set(a.name,a),a.on("@close",function(){t._peers.delete(a.name)});var i=!0,s=!1,c=void 0;try{for(var u,d=n[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){var l=u.value;try{this._handleConsumerData(l,a)}catch(e){_.error("error handling existing Consumer in Peer:%o",e)}}}catch(e){s=!0,c=e}finally{try{!i&&d.return&&d.return()}finally{if(s)throw c}}this.joined&&this.safeEmit("newpeer",a)}},{key:"_handleConsumerData",value:function(e,t){var r=e.id,n=e.kind,o=e.rtpParameters,a=e.paused,i=e.appData,s=new y.default(r,n,o,t,i);p.canReceive(s.rtpParameters,this._extendedRtpCapabilities)&&s.setSupported(!0),a&&s.remotePause(),t.addConsumer(s)}},{key:"joined",get:function(){return this._state===g.joined}},{key:"closed",get:function(){return this._state===g.closed}},{key:"peerName",get:function(){return this._peerName}},{key:"transports",get:function(){return Array.from(this._transports.values())}},{key:"producers",get:function(){return Array.from(this._producers.values())}},{key:"peers",get:function(){return Array.from(this._peers.values())}}]),t}();r.default=b},{"./Consumer":2,"./Device":3,"./EnhancedEventEmitter":4,"./Logger":5,"./Peer":6,"./Producer":7,"./Transport":9,"./errors":10,"./ortc":22}],9:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function a(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function i(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=n(e("./Logger")),u=n(e("./EnhancedEventEmitter")),d=e("./errors"),l=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("./utils")),p=n(e("./Device")),f=n(e("./CommandQueue")),m=new c.default("Transport"),h=function(e){function t(e,r,n,i){o(this,t);var s=a(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,m));return m.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,r),s._id=l.randomNumber(),s._closed=!1,s._direction=e,s._settings=n,s._appData=i,s._statsEnabled=!1,s._commandQueue=new f.default,s._handler=new p.default.Handler(e,r,n),s._connectionState="new",s._commandQueue.on("exec",s._execCommand.bind(s)),s._handleHandler(),s}return i(t,u.default),s(t,[{key:"close",value:function(e){m.debug("close()"),this._closed||(this._closed=!0,this._statsEnabled&&(this._statsEnabled=!1,this.disableStats()),this.safeEmit("@notify","closeTransport",{id:this._id,appData:e}),this.emit("@close"),this.safeEmit("close","local",e),this._destroy())}},{key:"remoteClose",value:function(e){m.debug("remoteClose()"),this._closed||(this._closed=!0,this.emit("@close"),this.safeEmit("close","remote",e),this._destroy())}},{key:"_destroy",value:function(){this._commandQueue.close(),this._handler.close()}},{key:"restartIce",value:function(){var e=this;m.debug("restartIce()"),this._closed||"new"!==this._connectionState&&Promise.resolve().then(function(){var t={id:e._id};return e.safeEmitAsPromise("@request","restartTransport",t)}).then(function(t){var r=t.iceParameters;return e._commandQueue.push("restartIce",{remoteIceParameters:r})}).catch(function(e){m.error("restartIce() | failed: %o",e)})}},{key:"enableStats",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:1e3;m.debug("enableStats() [interval:%s]",e),("number"!=typeof e||e<1e3)&&(e=1e3),this._statsEnabled=!0;var t={id:this._id,interval:e};this.safeEmit("@notify","enableTransportStats",t)}},{key:"disableStats",value:function(){m.debug("disableStats()"),this._statsEnabled=!1;var e={id:this._id};this.safeEmit("@notify","disableTransportStats",e)}},{key:"_handleHandler",value:function(){var e=this,t=this._handler;t.on("@connectionstatechange",function(t){e._connectionState!==t&&(m.debug("Transport connection state changed to %s",t),e._connectionState=t,e._closed||e.safeEmit("connectionstatechange",t))}),t.on("@needcreatetransport",function(t,r,n){var o={id:e._id,direction:e._direction,options:e._settings.transportOptions,appData:e._appData};t&&(o.dtlsParameters=t.dtlsParameters),e.safeEmit("@request","createTransport",o,r,n)}),t.on("@needupdatetransport",function(t){var r={id:e._id,dtlsParameters:t.dtlsParameters};e.safeEmit("@notify","updateTransport",r)}),t.on("@needupdateproducer",function(t,r){var n={id:t.id,rtpParameters:r};t.setRtpParameters(r),e.safeEmit("@notify","updateProducer",n)})}},{key:"addProducer",value:function(e){return m.debug("addProducer() [producer:%o]",e),this._closed?Promise.reject(new d.InvalidStateError("Transport closed")):"send"!==this._direction?Promise.reject(new Error("not a sending Transport")):this._commandQueue.push("addProducer",{producer:e})}},{key:"removeProducer",value:function(e,t,r){m.debug("removeProducer() [producer:%o]",e),this._closed||this._commandQueue.push("removeProducer",{producer:e}).catch(function(){}),"local"===t&&this.safeEmit("@notify","closeProducer",{id:e.id,appData:r})}},{key:"pauseProducer",value:function(e,t){m.debug("pauseProducer() [producer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","pauseProducer",r)}},{key:"resumeProducer",value:function(e,t){m.debug("resumeProducer() [producer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","resumeProducer",r)}},{key:"replaceProducerTrack",value:function(e,t){return m.debug("replaceProducerTrack() [producer:%o]",e),this._commandQueue.push("replaceProducerTrack",{producer:e,track:t})}},{key:"enableProducerStats",value:function(e,t){m.debug("enableProducerStats() [producer:%o]",e);var r={id:e.id,interval:t};this.safeEmit("@notify","enableProducerStats",r)}},{key:"disableProducerStats",value:function(e){m.debug("disableProducerStats() [producer:%o]",e);var t={id:e.id};this.safeEmit("@notify","disableProducerStats",t)}},{key:"addConsumer",value:function(e){return m.debug("addConsumer() [consumer:%o]",e),this._closed?Promise.reject(new d.InvalidStateError("Transport closed")):"recv"!==this._direction?Promise.reject(new Error("not a receiving Transport")):this._commandQueue.push("addConsumer",{consumer:e})}},{key:"removeConsumer",value:function(e){m.debug("removeConsumer() [consumer:%o]",e),this._commandQueue.push("removeConsumer",{consumer:e}).catch(function(){})}},{key:"pauseConsumer",value:function(e,t){m.debug("pauseConsumer() [consumer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","pauseConsumer",r)}},{key:"resumeConsumer",value:function(e,t){m.debug("resumeConsumer() [consumer:%o]",e);var r={id:e.id,appData:t};this.safeEmit("@notify","resumeConsumer",r)}},{key:"setConsumerPreferredProfile",value:function(e,t){m.debug("setConsumerPreferredProfile() [consumer:%o]",e);var r={id:e.id,profile:t};this.safeEmit("@notify","setConsumerPreferredProfile",r)}},{key:"enableConsumerStats",value:function(e,t){m.debug("enableConsumerStats() [consumer:%o]",e);var r={id:e.id,interval:t};this.safeEmit("@notify","enableConsumerStats",r)}},{key:"disableConsumerStats",value:function(e){m.debug("disableConsumerStats() [consumer:%o]",e);var t={id:e.id};this.safeEmit("@notify","disableConsumerStats",t)}},{key:"remoteStats",value:function(e){this.safeEmit("stats",e)}},{key:"_execCommand",value:function(e,t){var r=void 0;try{switch(e.method){case"addProducer":var n=e.producer;r=this._execAddProducer(n);break;case"removeProducer":var o=e.producer;r=this._execRemoveProducer(o);break;case"replaceProducerTrack":var a=e.producer,i=e.track;r=this._execReplaceProducerTrack(a,i);break;case"addConsumer":var s=e.consumer;r=this._execAddConsumer(s);break;case"removeConsumer":var c=e.consumer;r=this._execRemoveConsumer(c);break;case"restartIce":var u=e.remoteIceParameters;r=this._execRestartIce(u);break;default:r=Promise.reject(new Error('unknown command method "'+e.method+'"'))}}catch(e){r=Promise.reject(e)}t.promise=r}},{key:"_execAddProducer",value:function(e){var t=this;m.debug("_execAddProducer()");var r=void 0;return Promise.resolve().then(function(){return t._handler.addProducer(e)}).then(function(n){r=n;var o={id:e.id,kind:e.kind,transportId:t._id,rtpParameters:n,paused:e.locallyPaused,appData:e.appData};return t.safeEmitAsPromise("@request","createProducer",o)}).then(function(){e.setRtpParameters(r)})}},{key:"_execRemoveProducer",value:function(e){return m.debug("_execRemoveProducer()"),this._handler.removeProducer(e)}},{key:"_execReplaceProducerTrack",value:function(e,t){return m.debug("_execReplaceProducerTrack()"),this._handler.replaceProducerTrack(e,t)}},{key:"_execAddConsumer",value:function(e){var t=this;m.debug("_execAddConsumer()");var r=void 0;return Promise.resolve().then(function(){return t._handler.addConsumer(e)}).then(function(n){r=n;var o={id:e.id,transportId:t.id,paused:e.locallyPaused,preferredProfile:e.preferredProfile};return t.safeEmitAsPromise("@request","enableConsumer",o)}).then(function(t){var n=t.paused,o=t.preferredProfile,a=t.effectiveProfile;return n&&e.remotePause(),o&&e.remoteSetPreferredProfile(o),a&&e.remoteEffectiveProfileChanged(a),r})}},{key:"_execRemoveConsumer",value:function(e){return m.debug("_execRemoveConsumer()"),this._handler.removeConsumer(e)}},{key:"_execRestartIce",value:function(e){return m.debug("_execRestartIce()"),this._handler.restartIce(e)}},{key:"id",get:function(){return this._id}},{key:"closed",get:function(){return this._closed}},{key:"direction",get:function(){return this._direction}},{key:"appData",get:function(){return this._appData}},{key:"connectionState",get:function(){return this._connectionState}}]),t}();r.default=h},{"./CommandQueue":1,"./Device":3,"./EnhancedEventEmitter":4,"./Logger":5,"./errors":10,"./utils":23}],10:[function(e,t,r){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});r.InvalidStateError=function(e){function t(e){n(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Object.defineProperty(r,"name",{enumerable:!1,writable:!1,value:"InvalidStateError"}),Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(r,t):Object.defineProperty(r,"stack",{enumerable:!1,writable:!1,value:new Error(e).stack}),r}return a(t,Error),t}(),r.TimeoutError=function(e){function t(e){n(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Object.defineProperty(r,"name",{enumerable:!1,writable:!1,value:"TimeoutError"}),Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(r,t):Object.defineProperty(r,"stack",{enumerable:!1,writable:!1,value:new Error(e).stack}),r}return a(t,Error),t}(),r.UnsupportedError=function(e){function t(e,r){n(this,t);var a=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return Object.defineProperty(a,"name",{enumerable:!1,writable:!1,value:"UnsupportedError"}),Object.defineProperty(a,"data",{enumerable:!0,writable:!1,value:r}),Error.hasOwnProperty("captureStackTrace")?Error.captureStackTrace(a,t):Object.defineProperty(a,"stack",{enumerable:!1,writable:!1,value:new Error(e).stack}),a}return a(t,Error),t}()},{}],11:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=o(e("sdp-transform")),d=o(e("../Logger")),l=o(e("../EnhancedEventEmitter")),p=n(e("../utils")),f=n(e("../ortc")),m=n(e("./sdp/commonUtils")),h=n(e("./sdp/planBUtils")),v=o(e("./sdp/RemotePlanBSdp")),y=new d.default("Chrome55"),_=function(e){function t(e,r,n){a(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,y));return o._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new v.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return s(t,l.default),c(t,[{key:"close",value:function(){y.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(),g=function(e){function t(e,r){a(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"send",e,r));return n._transportReady=!1,n._stream=new MediaStream,n}return s(t,_),c(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(y.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return Promise.reject("track already added");var n=void 0;return Promise.resolve().then(function(){return t._stream.addTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()}).then(function(n){if(e.simulcast){y.debug("addProducer() | enabling simulcast");var o=u.default.parse(n.sdp);h.addSimulcastForTrack(o,r),n={type:"offer",sdp:u.default.write(o)}}return y.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",n),t._pc.setLocalDescription(n)}).then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){n=u.default.parse(t._pc.localDescription.sdp);var e={type:"answer",sdp:t._remoteSdp.createAnswerSdp(n)};return y.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){var o=p.clone(t._rtpParametersByKind[e.kind]);return h.fillRtpParametersForTrack(o,n,r),o}).catch(function(e){throw t._stream.removeTrack(r),t._pc.addStream(t._stream),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return y.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){return t._stream.removeTrack(r),t._pc.addStream(t._stream),t._pc.createOffer()}).then(function(e){return y.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0!==t._stream.getTracks().length)throw e;y.warn("removeProducer() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==t._pc.signalingState){var e=u.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return y.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;y.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track,o=void 0;return Promise.resolve().then(function(){return r._stream.removeTrack(n),r._stream.addTrack(t),r._pc.addStream(r._stream),r._pc.createOffer()}).then(function(n){if(e.simulcast){y.debug("addProducer() | enabling simulcast");var o=u.default.parse(n.sdp);h.addSimulcastForTrack(o,t),n={type:"offer",sdp:u.default.write(o)}}return y.debug("replaceProducerTrack() | calling pc.setLocalDescription() [offer:%o]",n),r._pc.setLocalDescription(n)}).then(function(){o=u.default.parse(r._pc.localDescription.sdp);var e={type:"answer",sdp:r._remoteSdp.createAnswerSdp(o)};return y.debug("replaceProducerTrack() | calling pc.setRemoteDescription() [answer:%o]",e),r._pc.setRemoteDescription(e)}).then(function(){var n=p.clone(r._rtpParametersByKind[e.kind]);h.fillRtpParametersForTrack(n,o,t),r.safeEmit("@needupdateproducer",e,n)}).catch(function(e){throw r._stream.removeTrack(t),r._stream.addTrack(n),r._pc.addStream(r._stream),e})}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=u.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,n=u.default.parse(r),o=m.extractDtlsParameters(n);return o.role="server",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),b=function(e){function t(e,r){a(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return s(t,_),c(t,[{key:"addConsumer",value:function(e){var t=this;if(y.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject("Consumer already added");var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getRemoteStreams()[0].getTrackById(o.trackId);if(!e)throw new Error("remote track not found");return e})}},{key:"removeConsumer",value:function(e){var t=this;return y.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject("Consumer not found")}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){y.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=u.default.parse(e),r={dtlsParameters:m.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),w=function(){function e(t,r,n){a(this,e),y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var o=void 0;switch(t){case"send":return o={audio:f.getSendingRtpParameters("audio",r),video:f.getSendingRtpParameters("video",r)},new g(o,n);case"recv":return o={audio:f.getReceivingFullRtpParameters("audio",r),video:f.getReceivingFullRtpParameters("video",r)},new b(o,n)}}return c(e,null,[{key:"getNativeRtpCapabilities",value:function(){y.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(t){try{e.close()}catch(e){}var r=u.default.parse(t.sdp);return m.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"name",get:function(){return"Chrome55"}}]),e}();r.default=w},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":22,"../utils":23,"./sdp/RemotePlanBSdp":16,"./sdp/commonUtils":18,"./sdp/planBUtils":19,"sdp-transform":32}],12:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=o(e("../Logger")),d=o(e("../EnhancedEventEmitter")),l=n(e("../utils")),p=n(e("../ortc")),f=n(e("./ortc/edgeUtils")),m="CNAME-EDGE-"+l.randomNumber(),h=new u.default("Edge11"),v=function(e){function t(e,r,n){a(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,h));return h.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",e,r),o._rtpParametersByKind={audio:p.getSendingRtpParameters("audio",r),video:p.getSendingRtpParameters("video",r)},o._transportReady=!1,o._iceGatherer=null,o._iceTransport=null,o._dtlsTransport=null,o._rtpSenders=new Map,o._rtpReceivers=new Map,o._transportRemoteParameters=null,o._setIceGatherer(n),o._setIceTransport(),o._setDtlsTransport(),o}return s(t,d.default),c(t,null,[{key:"getNativeRtpCapabilities",value:function(){return h.debug("getNativeRtpCapabilities()"),f.getCapabilities()}},{key:"name",get:function(){return"Edge11"}}]),c(t,[{key:"close",value:function(){h.debug("close()");try{this._iceGatherer.close()}catch(e){}try{this._iceTransport.stop()}catch(e){}try{this._dtlsTransport.stop()}catch(e){}var e=!0,t=!1,r=void 0;try{for(var n,o=this._rtpSenders.values()[Symbol.iterator]();!(e=(n=o.next()).done);e=!0){var a=n.value;try{a.stop()}catch(e){}}}catch(e){t=!0,r=e}finally{try{!e&&o.return&&o.return()}finally{if(t)throw r}}var i=!0,s=!1,c=void 0;try{for(var u,d=this._rtpReceivers.values()[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){var l=u.value;try{l.stop()}catch(e){}}}catch(e){s=!0,c=e}finally{try{!i&&d.return&&d.return()}finally{if(s)throw c}}}},{key:"addProducer",value:function(e){var t=this,r=e.track;return h.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._rtpSenders.has(e.id)?Promise.reject("Producer already added"):Promise.resolve().then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){h.debug("addProducer() | calling new RTCRtpSender()");var n=new RTCRtpSender(r,t._dtlsTransport),o=l.clone(t._rtpParametersByKind[e.kind]),a={ssrc:l.randomNumber()};o.codecs.some(function(e){return"rtx"===e.name})&&(a.rtx={ssrc:l.randomNumber()}),o.encodings.push(a),o.rtcp={cname:m,reducedSize:!0,mux:!0};var i=f.mangleRtpParameters(o);return h.debug("addProducer() | calling rtpSender.send() [params:%o]",i),n.send(i),t._rtpSenders.set(e.id,n),o})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return h.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var r=t._rtpSenders.get(e.id);if(!r)throw new Error("RTCRtpSender not found");t._rtpSenders.delete(e.id);try{h.debug("removeProducer() | calling rtpSender.stop()"),r.stop()}catch(e){h.warn("rtpSender.stop() failed:%o",e)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;return h.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id),Promise.resolve().then(function(){var n=r._rtpSenders.get(e.id);if(!n)throw new Error("RTCRtpSender not found");n.setTrack(t)})}},{key:"addConsumer",value:function(e){var t=this;return h.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._rtpReceivers.has(e.id)?Promise.reject("Consumer already added"):Promise.resolve().then(function(){h.debug("addProducer() | calling new RTCRtpReceiver()");var r=new RTCRtpReceiver(t._dtlsTransport,e.kind);r.addEventListener("error",function(e){h.error('iceGatherer "error" event [event:%o]',e)});var n=f.mangleRtpParameters(e.rtpParameters);h.debug("addProducer() | calling rtpReceiver.receive() [params:%o]",n),r.receive(n),t._rtpReceivers.set(e.id,r)})}},{key:"removeConsumer",value:function(e){var t=this;return h.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),Promise.resolve().then(function(){var r=t._rtpReceivers.get(e.id);if(!r)throw new Error("RTCRtpReceiver not found");t._rtpReceivers.delete(e.id);try{h.debug("removeConsumer() | calling rtpReceiver.stop()"),r.stop()}catch(e){h.warn("rtpReceiver.stop() failed:%o",e)}})}},{key:"restartIce",value:function(e){var t=this;h.debug("restartIce()"),Promise.resolve().then(function(){t._transportRemoteParameters.iceParameters=e;var r=t._transportRemoteParameters.iceCandidates;h.debug("restartIce() | calling iceTransport.start()"),t._iceTransport.start(t._iceGatherer,e,"controlling");var n=!0,o=!1,a=void 0;try{for(var i,s=r[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;t._iceTransport.addRemoteCandidate(c)}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}t._iceTransport.addRemoteCandidate({})})}},{key:"_setIceGatherer",value:function(e){var t=new RTCIceGatherer({iceServers:e.turnServers||[],gatherPolicy:"all"});t.addEventListener("error",function(e){h.error('iceGatherer "error" event [event:%o]',e)});try{t.gather()}catch(e){h.debug("iceGatherer.gather() failed: %s",e.toString())}this._iceGatherer=t}},{key:"_setIceTransport",value:function(){var e=this,t=new RTCIceTransport(this._iceGatherer);t.addEventListener("statechange",function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}}),t.addEventListener("icestatechange",function(){switch(t.state){case"checking":e.emit("@connectionstatechange","connecting");break;case"connected":case"completed":e.emit("@connectionstatechange","connected");break;case"failed":e.emit("@connectionstatechange","failed");break;case"disconnected":e.emit("@connectionstatechange","disconnected");break;case"closed":e.emit("@connectionstatechange","closed")}}),t.addEventListener("candidatepairchange",function(e){h.debug('iceTransport "candidatepairchange" event [pair:%o]',e.pair)}),this._iceTransport=t}},{key:"_setDtlsTransport",value:function(){var e=new RTCDtlsTransport(this._iceTransport);e.addEventListener("statechange",function(){h.debug('dtlsTransport "statechange" event [state:%s]',e.state)}),e.addEventListener("dtlsstatechange",function(){h.debug('dtlsTransport "dtlsstatechange" event [state:%s]',e.state)}),e.addEventListener("error",function(e){h.error('dtlsTransport "error" event [event:%o]',e)}),this._dtlsTransport=e}},{key:"_setupTransport",value:function(){var e=this;return h.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._dtlsTransport.getLocalParameters();return r.role="server",t.dtlsParameters=r,e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._transportRemoteParameters=t;var r=t.iceParameters,n=t.iceCandidates,o=t.dtlsParameters;e._iceTransport.start(e._iceGatherer,r,"controlling");var a=!0,i=!1,s=void 0;try{for(var c,u=n[Symbol.iterator]();!(a=(c=u.next()).done);a=!0){var d=c.value;e._iceTransport.addRemoteCandidate(d)}}catch(e){i=!0,s=e}finally{try{!a&&u.return&&u.return()}finally{if(i)throw s}}e._iceTransport.addRemoteCandidate({}),o.fingerprints=o.fingerprints.filter(function(e){return"sha-256"===e.algorithm||"sha-384"===e.algorithm||"sha-512"===e.algorithm}),e._dtlsTransport.start(o),e._transportReady=!0})}}]),t}();r.default=v},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":22,"../utils":23,"./ortc/edgeUtils":15}],13:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=o(e("sdp-transform")),d=o(e("../Logger")),l=o(e("../EnhancedEventEmitter")),p=n(e("../utils")),f=n(e("../ortc")),m=n(e("./sdp/commonUtils")),h=n(e("./sdp/unifiedPlanUtils")),v=o(e("./sdp/RemoteUnifiedPlanSdp")),y=new d.default("Firefox50"),_=function(e){function t(e,r,n){a(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,y));return o._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new v.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return s(t,l.default),c(t,[{key:"close",value:function(){y.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(),g=function(e){function t(e,r){a(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"send",e,r));return n._transportReady=!1,n._stream=new MediaStream,n._nextRid=1,n}return s(t,_),c(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(y.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return Promise.reject("track already added");var n=void 0,o=void 0;return Promise.resolve().then(function(){t._stream.addTrack(r),n=t._pc.addTrack(r,t._stream)}).then(function(){if(e.simulcast){y.debug("addProducer() | enabling simulcast");var r=[];return e.simulcast.high&&r.push({rid:"high"+t._nextRid,active:!0,priority:"high",maxBitrate:e.simulcast.high}),e.simulcast.medium&&r.push({rid:"medium"+t._nextRid,active:!0,priority:"medium",maxBitrate:e.simulcast.medium}),e.simulcast.low&&r.push({rid:"low"+t._nextRid,active:!0,priority:"low",maxBitrate:e.simulcast.low}),t._nextRid++,n.setParameters({encodings:r})}}).then(function(){return t._pc.createOffer()}).then(function(e){return y.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){o=u.default.parse(t._pc.localDescription.sdp);var e={type:"answer",sdp:t._remoteSdp.createAnswerSdp(o)};return y.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){var n=p.clone(t._rtpParametersByKind[e.kind]);return h.fillRtpParametersForTrack(n,o,r),n}).catch(function(e){try{t._pc.removeTrack(n)}catch(e){}throw t._stream.removeTrack(r),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return y.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var e=t._pc.getSenders().find(function(e){return e.track===r});if(!e)throw new Error("RTCRtpSender found");return t._pc.removeTrack(e),t._stream.removeTrack(r),Promise.resolve().then(function(){return t._pc.createOffer()}).then(function(e){return y.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)})}).then(function(){var e=u.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return y.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;y.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=u.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,n=u.default.parse(r),o=m.extractDtlsParameters(n);return o.role="server",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),b=function(e){function t(e,r){a(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"recv",e,r));n._transportCreated=!1,n._transportUpdated=!1,n._consumerInfos=new Map;var o={mid:"fake-datachannel-consumer",kind:"application",closed:!1,cname:null};return n._consumerInfos.set(555,o),n}return s(t,_),c(t,[{key:"addConsumer",value:function(e){var t=this;if(y.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject("Consumer already added");var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={mid:"consumer-"+e.kind+"-"+e.id,kind:e.kind,closed:e.closed,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return y.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getReceivers().find(function(e){var t=e.track;return!!t&&t.id===o.trackId});if(!e)throw new Error("remote track not found");return e.track})}},{key:"removeConsumer",value:function(e){var t=this;y.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind);var r=this._consumerInfos.get(e.id);return r?(r.closed=!0,Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return y.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject("Consumer not found")}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._consumerInfos.values()))};return y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){y.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=u.default.parse(e),r={dtlsParameters:m.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),w=function(){function e(t,r,n){a(this,e),y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var o=void 0;switch(t){case"send":return o={audio:f.getSendingRtpParameters("audio",r),video:f.getSendingRtpParameters("video",r)},new g(o,n);case"recv":return o={audio:f.getReceivingFullRtpParameters("audio",r),video:f.getReceivingFullRtpParameters("video",r)},new b(o,n)}}return c(e,null,[{key:"getNativeRtpCapabilities",value:function(){y.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),t=document.createElement("canvas");t.getContext("2d");var r=t.captureStream(),n=r.getVideoTracks()[0];return e.addTrack(n,r).setParameters({encodings:[{rid:"RID1",maxBitrate:4e4},{rid:"RID2",maxBitrate:1e4}]}),e.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0}).then(function(r){try{t.remove()}catch(e){}try{e.close()}catch(e){}var n=u.default.parse(r.sdp);return m.extractRtpCapabilities(n)}).catch(function(r){try{t.remove()}catch(e){}try{e.close()}catch(e){}throw r})}},{key:"name",get:function(){return"Firefox50"}}]),e}();r.default=w},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":22,"../utils":23,"./sdp/RemoteUnifiedPlanSdp":17,"./sdp/commonUtils":18,"./sdp/unifiedPlanUtils":20,"sdp-transform":32}],14:[function(e,t,r){"use strict";function n(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}function o(e){return e&&e.__esModule?e:{default:e}}function a(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function s(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}Object.defineProperty(r,"__esModule",{value:!0});var c=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),u=o(e("sdp-transform")),d=o(e("../Logger")),l=o(e("../EnhancedEventEmitter")),p=n(e("../utils")),f=n(e("../ortc")),m=n(e("./sdp/commonUtils")),h=n(e("./sdp/planBUtils")),v=o(e("./sdp/RemotePlanBSdp")),y=new d.default("Safari11"),_=function(e){function t(e,r,n){a(this,t);var o=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,y));return o._pc=new RTCPeerConnection({iceServers:n.turnServers||[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"}),o._rtpParametersByKind=r,o._remoteSdp=new v.default(e,r),o._pc.addEventListener("iceconnectionstatechange",function(){switch(o._pc.iceConnectionState){case"checking":o.emit("@connectionstatechange","connecting");break;case"connected":case"completed":o.emit("@connectionstatechange","connected");break;case"failed":o.emit("@connectionstatechange","failed");break;case"disconnected":o.emit("@connectionstatechange","disconnected");break;case"closed":o.emit("@connectionstatechange","closed")}}),o}return s(t,l.default),c(t,[{key:"close",value:function(){y.debug("close()");try{this._pc.close()}catch(e){}}}]),t}(),g=function(e){function t(e,r){a(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"send",e,r));return n._transportReady=!1,n._stream=new MediaStream,n}return s(t,_),c(t,[{key:"addProducer",value:function(e){var t=this,r=e.track;if(y.debug("addProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),this._stream.getTrackById(r.id))return Promise.reject("track already added");var n=void 0,o=void 0;return Promise.resolve().then(function(){return t._stream.addTrack(r),n=t._pc.addTrack(r,t._stream),t._pc.createOffer()}).then(function(e){return y.debug("addProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportReady)return t._setupTransport()}).then(function(){o=u.default.parse(t._pc.localDescription.sdp);var e={type:"answer",sdp:t._remoteSdp.createAnswerSdp(o)};return y.debug("addProducer() | calling pc.setRemoteDescription() [answer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){var n=p.clone(t._rtpParametersByKind[e.kind]);return h.fillRtpParametersForTrack(n,o,r),n}).catch(function(e){try{t._pc.removeTrack(n)}catch(e){}throw t._stream.removeTrack(r),e})}},{key:"removeProducer",value:function(e){var t=this,r=e.track;return y.debug("removeProducer() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,r.id),Promise.resolve().then(function(){var e=t._pc.getSenders().find(function(e){return e.track===r});if(!e)throw new Error("RTCRtpSender found");return t._pc.removeTrack(e),t._stream.removeTrack(r),t._pc.createOffer()}).then(function(e){return y.debug("removeProducer() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).catch(function(e){if(0!==t._stream.getTracks().length)throw e;y.warn("removeLocalTrack() | ignoring expected error due no sending tracks: %s",e.toString())}).then(function(){if("stable"!==t._pc.signalingState){var e=u.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return y.debug("removeProducer() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)}})}},{key:"replaceProducerTrack",value:function(e,t){var r=this;y.debug("replaceProducerTrack() [id:%s, kind:%s, trackId:%s]",e.id,e.kind,t.id);var n=e.track;return Promise.resolve().then(function(){var e=r._pc.getSenders().find(function(e){return e.track===n});if(!e)throw new Error("local track not found");return e.replaceTrack(t)}).then(function(){r._stream.removeTrack(n),r._stream.addTrack(t)})}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){return t._pc.createOffer({iceRestart:!0})}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [offer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){var e=u.default.parse(t._pc.localDescription.sdp),r={type:"answer",sdp:t._remoteSdp.createAnswerSdp(e)};return y.debug("restartIce() | calling pc.setRemoteDescription() [answer:%o]",r),t._pc.setRemoteDescription(r)})}},{key:"_setupTransport",value:function(){var e=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){var t={},r=e._pc.localDescription.sdp,n=u.default.parse(r),o=m.extractDtlsParameters(n);return o.role="server",t.dtlsParameters=o,e._remoteSdp.setTransportLocalParameters(t),e.safeEmitAsPromise("@needcreatetransport",t)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportReady=!0})}}]),t}(),b=function(e){function t(e,r){a(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,"recv",e,r));return n._transportCreated=!1,n._transportUpdated=!1,n._kinds=new Set,n._consumerInfos=new Map,n}return s(t,_),c(t,[{key:"addConsumer",value:function(e){var t=this;if(y.debug("addConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id))return Promise.reject("Consumer already added");var r=e.rtpParameters.encodings[0],n=e.rtpParameters.rtcp.cname,o={kind:e.kind,trackId:"consumer-"+e.kind+"-"+e.id,ssrc:r.ssrc,cname:n};return r.rtx&&r.rtx.ssrc&&(o.rtxSsrc=r.rtx.ssrc),this._consumerInfos.set(e.id,o),this._kinds.add(e.kind),Promise.resolve().then(function(){if(!t._transportCreated)return t._setupTransport()}).then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("addConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("addConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)}).then(function(){if(!t._transportUpdated)return t._updateTransport()}).then(function(){var e=t._pc.getReceivers().find(function(e){var t=e.track;return!!t&&t.id===o.trackId});if(!e)throw new Error("remote track not found");return e.track})}},{key:"removeConsumer",value:function(e){var t=this;return y.debug("removeConsumer() [id:%s, kind:%s]",e.id,e.kind),this._consumerInfos.has(e.id)?(this._consumerInfos.delete(e.id),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("removeConsumer() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("removeConsumer() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})):Promise.reject("Consumer not found")}},{key:"restartIce",value:function(e){var t=this;return y.debug("restartIce()"),this._remoteSdp.updateTransportRemoteIceParameters(e),Promise.resolve().then(function(){var e={type:"offer",sdp:t._remoteSdp.createOfferSdp(Array.from(t._kinds),Array.from(t._consumerInfos.values()))};return y.debug("restartIce() | calling pc.setRemoteDescription() [offer:%o]",e),t._pc.setRemoteDescription(e)}).then(function(){return t._pc.createAnswer()}).then(function(e){return y.debug("restartIce() | calling pc.setLocalDescription() [answer:%o]",e),t._pc.setLocalDescription(e)})}},{key:"_setupTransport",value:function(){var e=this;return y.debug("_setupTransport()"),Promise.resolve().then(function(){return e.safeEmitAsPromise("@needcreatetransport",null)}).then(function(t){e._remoteSdp.setTransportRemoteParameters(t),e._transportCreated=!0})}},{key:"_updateTransport",value:function(){y.debug("_updateTransport()");var e=this._pc.localDescription.sdp,t=u.default.parse(e),r={dtlsParameters:m.extractDtlsParameters(t)};this.safeEmit("@needupdatetransport",r),this._transportUpdated=!0}}]),t}(),w=function(){function e(t,r,n){a(this,e),y.debug("constructor() [direction:%s, extendedRtpCapabilities:%o]",t,r);var o=void 0;switch(t){case"send":return o={audio:f.getSendingRtpParameters("audio",r),video:f.getSendingRtpParameters("video",r)},new g(o,n);case"recv":return o={audio:f.getReceivingFullRtpParameters("audio",r),video:f.getReceivingFullRtpParameters("video",r)},new b(o,n)}}return c(e,null,[{key:"getNativeRtpCapabilities",value:function(){y.debug("getNativeRtpCapabilities()");var e=new RTCPeerConnection({iceServers:[],iceTransportPolicy:"all",bundlePolicy:"max-bundle",rtcpMuxPolicy:"require"});return e.addTransceiver("audio"),e.addTransceiver("video"),e.createOffer().then(function(t){try{e.close()}catch(e){}var r=u.default.parse(t.sdp);return m.extractRtpCapabilities(r)}).catch(function(t){try{e.close()}catch(e){}throw t})}},{key:"name",get:function(){return"Safari11"}}]),e}();r.default=w},{"../EnhancedEventEmitter":4,"../Logger":5,"../ortc":22,"../utils":23,"./sdp/RemotePlanBSdp":16,"./sdp/commonUtils":18,"./sdp/planBUtils":19,"sdp-transform":32}],15:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.getCapabilities=function(){var e=RTCRtpReceiver.getCapabilities(),t=n.clone(e),r=!0,o=!1,a=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c=i.value;c.channels=c.numChannels,delete c.numChannels,"audio"!==c.kind?delete c.channels:c.channels||(c.channels=1),c.mimeType=c.kind+"/"+c.name,"rtx"===c.name&&(c.parameters.apt=Number(c.parameters.apt));var u=!0,d=!1,l=void 0;try{for(var p,f=(c.rtcpFeedback||[])[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var m=p.value;m.parameter||delete m.parameter}}catch(e){d=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw l}}}}catch(e){o=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw a}}return t},r.mangleRtpParameters=function(e){var t=n.clone(e),r=!0,o=!1,a=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(r=(i=s.next()).done);r=!0){var c=i.value;c.channels&&(c.numChannels=c.channels,delete c.channels),delete c.mimeType}}catch(e){o=!0,a=e}finally{try{!r&&s.return&&s.return()}finally{if(o)throw a}}return t};var n=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../../utils"))},{"../../utils":23}],16:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=n(e("sdp-transform")),u=n(e("../../Logger")),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../../utils")),l=new u.default("RemotePlanBSdp"),p=function(){function e(t){i(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:d.randomNumber(),version:0}}return s(e,[{key:"setTransportLocalParameters",value:function(e){l.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){l.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}},{key:"updateTransportRemoteIceParameters",value:function(e){l.debug("updateTransportRemoteIceParameters() [remoteIceParameters:%o]",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),f=function(e){function t(e){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return a(t,p),s(t,[{key:"createAnswerSdp",value:function(e){if(l.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,n=this._transportRemoteParameters.dtlsParameters,o={},a=(e.media||[]).map(function(e){return e.mid});this._sdpGlobalFields.version++,o.version=0,o.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},o.name="-",o.timing={start:0,stop:0},o.icelite=t.iceLite?"ice-lite":null,o.msidSemantic={semantic:"WMS",token:"*"},o.groups=[{type:"BUNDLE",mids:a.join(" ")}],o.media=[];var i=n.fingerprints.length;o.fingerprint={type:n.fingerprints[i-1].algorithm,hash:n.fingerprints[i-1].value};var s=!0,u=!1,d=void 0;try{for(var p,f=(e.media||[])[Symbol.iterator]();!(s=(p=f.next()).done);s=!0){var m=p.value,h=m.type,v=this._rtpParametersByKind[h].codecs,y=this._rtpParametersByKind[h].headerExtensions,_={};_.type=m.type,_.port=7,_.protocol="RTP/SAVPF",_.connection={ip:"127.0.0.1",version:4},_.mid=m.mid,_.iceUfrag=t.usernameFragment,_.icePwd=t.password,_.candidates=[];var g=!0,b=!1,w=void 0;try{for(var P,k=r[Symbol.iterator]();!(g=(P=k.next()).done);g=!0){var S=P.value,C={};C.component=1,C.foundation=S.foundation,C.ip=S.ip,C.port=S.port,C.priority=S.priority,C.transport=S.protocol,C.type=S.type,S.tcpType&&(C.tcptype=S.tcpType),_.candidates.push(C)}}catch(e){b=!0,w=e}finally{try{!g&&k.return&&k.return()}finally{if(b)throw w}}switch(_.endOfCandidates="end-of-candidates",_.iceOptions="renomination",n.role){case"client":_.setup="active";break;case"server":_.setup="passive"}switch(m.direction){case"sendrecv":case"sendonly":_.direction="recvonly";break;case"recvonly":case"inactive":_.direction="inactive"}"video"===h&&(_.xGoogleFlag="conference"),_.rtp=[],_.rtcpFb=[],_.fmtp=[];var T=!0,E=!1,x=void 0;try{for(var R,O=v[Symbol.iterator]();!(T=(R=O.next()).done);T=!0){var j=R.value,I={payload:j.payloadType,codec:j.name,rate:j.clockRate};if(j.channels>1&&(I.encoding=j.channels),_.rtp.push(I),j.parameters){var D={payload:j.payloadType,config:""},F=!0,L=!1,M=void 0;try{for(var A,N=Object.keys(j.parameters)[Symbol.iterator]();!(F=(A=N.next()).done);F=!0){var B=A.value;D.config&&(D.config+=";"),D.config+=B+"="+j.parameters[B]}}catch(e){L=!0,M=e}finally{try{!F&&N.return&&N.return()}finally{if(L)throw M}}D.config&&_.fmtp.push(D)}if(j.rtcpFeedback){var U=!0,G=!1,z=void 0;try{for(var q,K=j.rtcpFeedback[Symbol.iterator]();!(U=(q=K.next()).done);U=!0){var V=q.value;_.rtcpFb.push({payload:j.payloadType,type:V.type,subtype:V.parameter||""})}}catch(e){G=!0,z=e}finally{try{!U&&K.return&&K.return()}finally{if(G)throw z}}}}}catch(e){E=!0,x=e}finally{try{!T&&O.return&&O.return()}finally{if(E)throw x}}_.payloads=v.map(function(e){return e.payloadType}).join(" "),_.ext=[];var W=!0,Q=!1,$=void 0;try{for(var J,X=y[Symbol.iterator]();!(W=(J=X.next()).done);W=!0)(function(e){if(!(m.ext||[]).find(function(t){return t.uri===e.uri}))return"continue";_.ext.push({uri:e.uri,value:e.id})})(J.value)}catch(e){Q=!0,$=e}finally{try{!W&&X.return&&X.return()}finally{if(Q)throw $}}_.rtcpMux="rtcp-mux",_.rtcpRsize="rtcp-rsize",o.media.push(_)}}catch(e){u=!0,d=e}finally{try{!s&&f.return&&f.return()}finally{if(u)throw d}}return c.default.write(o)}}]),t}(),m=function(e){function t(e){i(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._streamId="recv-stream-"+d.randomNumber(),r}return a(t,p),s(t,[{key:"createOfferSdp",value:function(e,t){var r=this;if(l.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var n=this._transportRemoteParameters.iceParameters,o=this._transportRemoteParameters.iceCandidates,a=this._transportRemoteParameters.dtlsParameters,i={},s=e;this._sdpGlobalFields.version++,i.version=0,i.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},i.name="-",i.timing={start:0,stop:0},i.icelite=n.iceLite?"ice-lite":null,i.msidSemantic={semantic:"WMS",token:"*"},i.groups=[{type:"BUNDLE",mids:s.join(" ")}],i.media=[];var u=a.fingerprints.length;i.fingerprint={type:a.fingerprints[u-1].algorithm,hash:a.fingerprints[u-1].value};var d=!0,p=!1,f=void 0;try{for(var m,h=e[Symbol.iterator]();!(d=(m=h.next()).done);d=!0)!function(e){var a=r._rtpParametersByKind[e].codecs,s=r._rtpParametersByKind[e].headerExtensions,c={};c.type=e,c.port=7,c.protocol="RTP/SAVPF",c.connection={ip:"127.0.0.1",version:4},c.mid=e,c.iceUfrag=n.usernameFragment,c.icePwd=n.password,c.candidates=[];var u=!0,d=!1,l=void 0;try{for(var p,f=o[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var m=p.value,h={};h.component=1,h.foundation=m.foundation,h.ip=m.ip,h.port=m.port,h.priority=m.priority,h.transport=m.protocol,h.type=m.type,m.tcpType&&(h.tcptype=m.tcpType),c.candidates.push(h)}}catch(e){d=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw l}}c.endOfCandidates="end-of-candidates",c.iceOptions="renomination",c.setup="actpass",t.some(function(t){return t.kind===e})?c.direction="sendonly":c.direction="inactive",c.rtp=[],c.rtcpFb=[],c.fmtp=[];var v=!0,y=!1,_=void 0;try{for(var g,b=a[Symbol.iterator]();!(v=(g=b.next()).done);v=!0){var w=g.value,P={payload:w.payloadType,codec:w.name,rate:w.clockRate};if(w.channels>1&&(P.encoding=w.channels),c.rtp.push(P),w.parameters){var k={payload:w.payloadType,config:""},S=!0,C=!1,T=void 0;try{for(var E,x=Object.keys(w.parameters)[Symbol.iterator]();!(S=(E=x.next()).done);S=!0){var R=E.value;k.config&&(k.config+=";"),k.config+=R+"="+w.parameters[R]}}catch(e){C=!0,T=e}finally{try{!S&&x.return&&x.return()}finally{if(C)throw T}}k.config&&c.fmtp.push(k)}if(w.rtcpFeedback){var O=!0,j=!1,I=void 0;try{for(var D,F=w.rtcpFeedback[Symbol.iterator]();!(O=(D=F.next()).done);O=!0){var L=D.value;c.rtcpFb.push({payload:w.payloadType,type:L.type,subtype:L.parameter||""})}}catch(e){j=!0,I=e}finally{try{!O&&F.return&&F.return()}finally{if(j)throw I}}}}}catch(e){y=!0,_=e}finally{try{!v&&b.return&&b.return()}finally{if(y)throw _}}c.payloads=a.map(function(e){return e.payloadType}).join(" "),c.ext=[];var M=!0,A=!1,N=void 0;try{for(var B,U=s[Symbol.iterator]();!(M=(B=U.next()).done);M=!0){var G=B.value;c.ext.push({uri:G.uri,value:G.id})}}catch(e){A=!0,N=e}finally{try{!M&&U.return&&U.return()}finally{if(A)throw N}}c.rtcpMux="rtcp-mux",c.rtcpRsize="rtcp-rsize",c.ssrcs=[],c.ssrcGroups=[];var z=!0,q=!1,K=void 0;try{for(var V,W=t[Symbol.iterator]();!(z=(V=W.next()).done);z=!0){var Q=V.value;Q.kind===e&&(c.ssrcs.push({id:Q.ssrc,attribute:"msid",value:r._streamId+" "+Q.trackId}),c.ssrcs.push({id:Q.ssrc,attribute:"mslabel",value:r._streamId}),c.ssrcs.push({id:Q.ssrc,attribute:"label",value:Q.trackId}),c.ssrcs.push({id:Q.ssrc,attribute:"cname",value:Q.cname}),Q.rtxSsrc&&(c.ssrcs.push({id:Q.rtxSsrc,attribute:"msid",value:r._streamId+" "+Q.trackId}),c.ssrcs.push({id:Q.rtxSsrc,attribute:"mslabel",value:r._streamId}),c.ssrcs.push({id:Q.rtxSsrc,attribute:"label",value:Q.trackId}),c.ssrcs.push({id:Q.rtxSsrc,attribute:"cname",value:Q.cname}),c.ssrcGroups.push({semantics:"FID",ssrcs:Q.ssrc+" "+Q.rtxSsrc})))}}catch(e){q=!0,K=e}finally{try{!z&&W.return&&W.return()}finally{if(q)throw K}}i.media.push(c)}(m.value)}catch(e){p=!0,f=e}finally{try{!d&&h.return&&h.return()}finally{if(p)throw f}}return c.default.write(i)}}]),t}();r.default=function e(t,r){switch(i(this,e),l.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new f(r);case"recv":return new m(r)}}},{"../../Logger":5,"../../utils":23,"sdp-transform":32}],17:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}function o(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(r,"__esModule",{value:!0});var s=function(){function e(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,r,n){return r&&e(t.prototype,r),n&&e(t,n),t}}(),c=n(e("sdp-transform")),u=n(e("../../Logger")),d=function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r]);return t.default=e,t}(e("../../utils")),l=new u.default("RemoteUnifiedPlanSdp"),p=function(){function e(t){i(this,e),this._rtpParametersByKind=t,this._transportLocalParameters=null,this._transportRemoteParameters=null,this._sdpGlobalFields={id:d.randomNumber(),version:0}}return s(e,[{key:"setTransportLocalParameters",value:function(e){l.debug("setTransportLocalParameters() [transportLocalParameters:%o]",e),this._transportLocalParameters=e}},{key:"setTransportRemoteParameters",value:function(e){l.debug("setTransportRemoteParameters() [transportRemoteParameters:%o]",e),this._transportRemoteParameters=e}},{key:"updateTransportRemoteIceParameters",value:function(e){l.debug("updateTransportRemoteIceParameters() [remoteIceParameters:%o]",e),this._transportRemoteParameters.iceParameters=e}}]),e}(),f=function(e){function t(e){return i(this,t),o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e))}return a(t,p),s(t,[{key:"createAnswerSdp",value:function(e){if(l.debug("createAnswerSdp()"),!this._transportLocalParameters)throw new Error("no transport local parameters");if(!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,n=this._transportRemoteParameters.dtlsParameters,o={},a=(e.media||[]).filter(function(e){return e.mid}).map(function(e){return e.mid});this._sdpGlobalFields.version++,o.version=0,o.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},o.name="-",o.timing={start:0,stop:0},o.icelite=t.iceLite?"ice-lite":null,o.msidSemantic={semantic:"WMS",token:"*"},a.length>0&&(o.groups=[{type:"BUNDLE",mids:a.join(" ")}]),o.media=[];var i=n.fingerprints.length;o.fingerprint={type:n.fingerprints[i-1].algorithm,hash:n.fingerprints[i-1].value};var s=!0,u=!1,d=void 0;try{for(var p,f=(e.media||[])[Symbol.iterator]();!(s=(p=f.next()).done);s=!0){var m=p.value,h="inactive"===m.direction,v=m.type,y=this._rtpParametersByKind[v].codecs,_=this._rtpParametersByKind[v].headerExtensions,g={};g.type=m.type,g.port=7,g.protocol="RTP/SAVPF",g.connection={ip:"127.0.0.1",version:4},g.mid=m.mid,g.iceUfrag=t.usernameFragment,g.icePwd=t.password,g.candidates=[];var b=!0,w=!1,P=void 0;try{for(var k,S=r[Symbol.iterator]();!(b=(k=S.next()).done);b=!0){var C=k.value,T={};T.component=1,T.foundation=C.foundation,T.ip=C.ip,T.port=C.port,T.priority=C.priority,T.transport=C.protocol,T.type=C.type,C.tcpType&&(T.tcptype=C.tcpType),g.candidates.push(T)}}catch(e){w=!0,P=e}finally{try{!b&&S.return&&S.return()}finally{if(w)throw P}}switch(g.endOfCandidates="end-of-candidates",g.iceOptions="renomination",n.role){case"client":g.setup="active";break;case"server":g.setup="passive"}switch(m.direction){case"sendrecv":case"sendonly":g.direction="recvonly";break;case"recvonly":case"inactive":g.direction="inactive"}g.rtp=[],g.rtcpFb=[],g.fmtp=[];var E=!0,x=!1,R=void 0;try{for(var O,j=y[Symbol.iterator]();!(E=(O=j.next()).done);E=!0){var I=O.value,D={payload:I.payloadType,codec:I.name,rate:I.clockRate};if(I.channels>1&&(D.encoding=I.channels),g.rtp.push(D),I.parameters){var F={payload:I.payloadType,config:""},L=!0,M=!1,A=void 0;try{for(var N,B=Object.keys(I.parameters)[Symbol.iterator]();!(L=(N=B.next()).done);L=!0){var U=N.value;F.config&&(F.config+=";"),F.config+=U+"="+I.parameters[U]}}catch(e){M=!0,A=e}finally{try{!L&&B.return&&B.return()}finally{if(M)throw A}}F.config&&g.fmtp.push(F)}if(I.rtcpFeedback){var G=!0,z=!1,q=void 0;try{for(var K,V=I.rtcpFeedback[Symbol.iterator]();!(G=(K=V.next()).done);G=!0){var W=K.value;g.rtcpFb.push({payload:I.payloadType,type:W.type,subtype:W.parameter||""})}}catch(e){z=!0,q=e}finally{try{!G&&V.return&&V.return()}finally{if(z)throw q}}}}}catch(e){x=!0,R=e}finally{try{!E&&j.return&&j.return()}finally{if(x)throw R}}if(g.payloads=y.map(function(e){return e.payloadType}).join(" "),!h){g.ext=[];var Q=!0,$=!1,J=void 0;try{for(var X,H=_[Symbol.iterator]();!(Q=(X=H.next()).done);Q=!0)(function(e){if(!(m.ext||[]).find(function(t){return t.uri===e.uri}))return"continue";g.ext.push({uri:e.uri,value:e.id})})(X.value)}catch(e){$=!0,J=e}finally{try{!Q&&H.return&&H.return()}finally{if($)throw J}}}if(m.simulcast_03){g.simulcast_03={value:m.simulcast_03.value.replace(/send/g,"recv")},g.rids=[];var Z=!0,Y=!1,ee=void 0;try{for(var te,re=(m.rids||[])[Symbol.iterator]();!(Z=(te=re.next()).done);Z=!0){var ne=te.value;"send"===ne.direction&&g.rids.push({id:ne.id,direction:"recv"})}}catch(e){Y=!0,ee=e}finally{try{!Z&&re.return&&re.return()}finally{if(Y)throw ee}}}g.rtcpMux="rtcp-mux",g.rtcpRsize="rtcp-rsize",o.media.push(g)}}catch(e){u=!0,d=e}finally{try{!s&&f.return&&f.return()}finally{if(u)throw d}}return c.default.write(o)}}]),t}(),m=function(e){function t(e){i(this,t);var r=o(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return r._streamId="recv-stream-"+d.randomNumber(),r}return a(t,p),s(t,[{key:"createOfferSdp",value:function(e){if(l.debug("createOfferSdp()"),!this._transportRemoteParameters)throw new Error("no transport remote parameters");var t=this._transportRemoteParameters.iceParameters,r=this._transportRemoteParameters.iceCandidates,n=this._transportRemoteParameters.dtlsParameters,o={},a=e.filter(function(e){return!e.closed}).map(function(e){return e.mid});this._sdpGlobalFields.version++,o.version=0,o.origin={address:"0.0.0.0",ipVer:4,netType:"IN",sessionId:this._sdpGlobalFields.id,sessionVersion:this._sdpGlobalFields.version,username:"mediasoup-client"},o.name="-",o.timing={start:0,stop:0},o.icelite=t.iceLite?"ice-lite":null,o.msidSemantic={semantic:"WMS",token:"*"},a.length>0&&(o.groups=[{type:"BUNDLE",mids:a.join(" ")}]),o.media=[];var i=n.fingerprints.length;o.fingerprint={type:n.fingerprints[i-1].algorithm,hash:n.fingerprints[i-1].value};var s=!0,u=!1,d=void 0;try{for(var p,f=e[Symbol.iterator]();!(s=(p=f.next()).done);s=!0){var m=p.value,h=m.closed,v=m.kind,y=void 0,_=void 0;"application"!==m.kind&&(y=this._rtpParametersByKind[v].codecs,_=this._rtpParametersByKind[v].headerExtensions);var g={};"application"!==m.kind?(g.type=v,g.port=7,g.protocol="RTP/SAVPF",g.connection={ip:"127.0.0.1",version:4},g.mid=m.mid,g.msid=this._streamId+" "+m.trackId):(g.type=v,g.port=9,g.protocol="DTLS/SCTP",g.connection={ip:"127.0.0.1",version:4},g.mid=m.mid),g.iceUfrag=t.usernameFragment,g.icePwd=t.password,g.candidates=[];var b=!0,w=!1,P=void 0;try{for(var k,S=r[Symbol.iterator]();!(b=(k=S.next()).done);b=!0){var C=k.value,T={};T.component=1,T.foundation=C.foundation,T.ip=C.ip,T.port=C.port,T.priority=C.priority,T.transport=C.protocol,T.type=C.type,C.tcpType&&(T.tcptype=C.tcpType),g.candidates.push(T)}}catch(e){w=!0,P=e}finally{try{!b&&S.return&&S.return()}finally{if(w)throw P}}if(g.endOfCandidates="end-of-candidates",g.iceOptions="renomination",g.setup="actpass","application"!==m.kind){g.direction=h?"inactive":"sendonly",g.rtp=[],g.rtcpFb=[],g.fmtp=[];var E=!0,x=!1,R=void 0;try{for(var O,j=y[Symbol.iterator]();!(E=(O=j.next()).done);E=!0){var I=O.value,D={payload:I.payloadType,codec:I.name,rate:I.clockRate};if(I.channels>1&&(D.encoding=I.channels),g.rtp.push(D),I.parameters){var F={payload:I.payloadType,config:""},L=!0,M=!1,A=void 0;try{for(var N,B=Object.keys(I.parameters)[Symbol.iterator]();!(L=(N=B.next()).done);L=!0){var U=N.value;F.config&&(F.config+=";"),F.config+=U+"="+I.parameters[U]}}catch(e){M=!0,A=e}finally{try{!L&&B.return&&B.return()}finally{if(M)throw A}}F.config&&g.fmtp.push(F)}if(I.rtcpFeedback){var G=!0,z=!1,q=void 0;try{for(var K,V=I.rtcpFeedback[Symbol.iterator]();!(G=(K=V.next()).done);G=!0){var W=K.value;g.rtcpFb.push({payload:I.payloadType,type:W.type,subtype:W.parameter||""})}}catch(e){z=!0,q=e}finally{try{!G&&V.return&&V.return()}finally{if(z)throw q}}}}}catch(e){x=!0,R=e}finally{try{!E&&j.return&&j.return()}finally{if(x)throw R}}if(g.payloads=y.map(function(e){return e.payloadType}).join(" "),!h){g.ext=[];var Q=!0,$=!1,J=void 0;try{for(var X,H=_[Symbol.iterator]();!(Q=(X=H.next()).done);Q=!0){var Z=X.value;g.ext.push({uri:Z.uri,value:Z.id})}}catch(e){$=!0,J=e}finally{try{!Q&&H.return&&H.return()}finally{if($)throw J}}}g.rtcpMux="rtcp-mux",g.rtcpRsize="rtcp-rsize",h||(g.ssrcs=[],g.ssrcGroups=[],g.ssrcs.push({id:m.ssrc,attribute:"cname",value:m.cname}),m.rtxSsrc&&(g.ssrcs.push({id:m.rtxSsrc,attribute:"cname",value:m.cname}),g.ssrcGroups.push({semantics:"FID",ssrcs:m.ssrc+" "+m.rtxSsrc})))}else g.payloads=5e3,g.sctpmap={app:"webrtc-datachannel",maxMessageSize:256,sctpmapNumber:5e3};o.media.push(g)}}catch(e){u=!0,d=e}finally{try{!s&&f.return&&f.return()}finally{if(u)throw d}}return c.default.write(o)}}]),t}();r.default=function e(t,r){switch(i(this,e),l.debug("constructor() [direction:%s, rtpParametersByKind:%o]",t,r),t){case"send":return new f(r);case"recv":return new m(r)}}},{"../../Logger":5,"../../utils":23,"sdp-transform":32}],18:[function(e,t,r){"use strict";function n(e){return(e.media||[]).find(function(e){return e.iceUfrag&&0!==e.port})}Object.defineProperty(r,"__esModule",{value:!0}),r.extractRtpCapabilities=function(e){var t=new Map,r=[],n=!1,a=!1,i=!0,s=!1,c=void 0;try{for(var u,d=e.media[Symbol.iterator]();!(i=(u=d.next()).done);i=!0){var l=u.value,p=l.type;switch(p){case"audio":if(n)continue;n=!0;break;case"video":if(a)continue;a=!0;break;default:continue}var f=!0,m=!1,h=void 0;try{for(var v,y=l.rtp[Symbol.iterator]();!(f=(v=y.next()).done);f=!0){var _=v.value;"audio"!==(I={name:_.codec,mimeType:p+"/"+_.codec,kind:p,clockRate:_.rate,preferredPayloadType:_.payload,channels:_.encoding,rtcpFeedback:[],parameters:{}}).kind?delete I.channels:I.channels||(I.channels=1),t.set(I.preferredPayloadType,I)}}catch(e){m=!0,h=e}finally{try{!f&&y.return&&y.return()}finally{if(m)throw h}}var g=!0,b=!1,w=void 0;try{for(var P,k=(l.fmtp||[])[Symbol.iterator]();!(g=(P=k.next()).done);g=!0){var S=P.value,C=o.default.parseFmtpConfig(S.config);(I=t.get(S.payload))&&(I.parameters=C)}}catch(e){b=!0,w=e}finally{try{!g&&k.return&&k.return()}finally{if(b)throw w}}var T=!0,E=!1,x=void 0;try{for(var R,O=(l.rtcpFb||[])[Symbol.iterator]();!(T=(R=O.next()).done);T=!0){var j=R.value,I=t.get(j.payload);if(I){var D={type:j.type,parameter:j.subtype};D.parameter||delete D.parameter,I.rtcpFeedback.push(D)}}}catch(e){E=!0,x=e}finally{try{!T&&O.return&&O.return()}finally{if(E)throw x}}var F=!0,L=!1,M=void 0;try{for(var A,N=(l.ext||[])[Symbol.iterator]();!(F=(A=N.next()).done);F=!0){var B=A.value,U={kind:p,uri:B.uri,preferredId:B.value};r.push(U)}}catch(e){L=!0,M=e}finally{try{!F&&N.return&&N.return()}finally{if(L)throw M}}}}catch(e){s=!0,c=e}finally{try{!i&&d.return&&d.return()}finally{if(s)throw c}}return{codecs:Array.from(t.values()),headerExtensions:r,fecMechanisms:[]}},r.extractDtlsParameters=function(e){var t=n(e),r=t.fingerprint||e.fingerprint,o=void 0;switch(t.setup){case"active":o="client";break;case"passive":o="server";break;case"actpass":o="auto"}return{role:o,fingerprints:[{algorithm:r.type,value:r.hash}]}};var o=function(e){return e&&e.__esModule?e:{default:e}}(e("sdp-transform"))},{"sdp-transform":32}],19:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0});var n=function(){function e(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=e[Symbol.iterator]();!(n=(i=s.next()).done)&&(r.push(i.value),!t||r.length!==t);n=!0);}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}();r.fillRtpParametersForTrack=function(e,t,r){var o=r.kind,a={cname:null,reducedSize:!0,mux:!0},i=(t.media||[]).find(function(e){return e.type===o});if(!i)throw new Error("m="+o+" section not found");var s=void 0,c=new Set,u=!0,d=!1,l=void 0;try{for(var p,f=(i.ssrcs||[])[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var m=p.value;if("msid"===m.attribute&&m.value.split(" ")[1]===r.id){var h=m.id;c.add(h),s||(s=h)}}}catch(e){d=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw l}}if(0===c.size)throw new Error("a=ssrc line not found for local track [track.id:"+r.id+"]");var v=new Map,y=!0,_=!1,g=void 0;try{for(var b,w=(i.ssrcGroups||[])[Symbol.iterator]();!(y=(b=w.next()).done);y=!0){var P=b.value;if("FID"===P.semantics){var k=P.ssrcs.split(/\s+/),S=n(k,2),C=S[0],T=S[1];C=Number(C),T=Number(T),c.has(C)&&(c.delete(C),c.delete(T),v.set(C,T))}}}catch(e){_=!0,g=e}finally{try{!y&&w.return&&w.return()}finally{if(_)throw g}}var E=!0,x=!1,R=void 0;try{for(var O,j=c[Symbol.iterator]();!(E=(O=j.next()).done);E=!0)C=O.value,v.set(C,null)}catch(e){x=!0,R=e}finally{try{!E&&j.return&&j.return()}finally{if(x)throw R}}var I=i.ssrcs.find(function(e){return"cname"===e.attribute&&e.id===s});I&&(a.cname=I.value),e.rtcp=a,e.encodings=[];var D=v.size>1,F=["low","medium","high"],L=!0,M=!1,A=void 0;try{for(var N,B=v[Symbol.iterator]();!(L=(N=B.next()).done);L=!0){var U=N.value,G=n(U,2),z={ssrc:G[0]};(T=G[1])&&(z.rtx={ssrc:T}),D&&(z.profile=F.shift()),e.encodings.push(z)}}catch(e){M=!0,A=e}finally{try{!L&&B.return&&B.return()}finally{if(M)throw A}}},r.addSimulcastForTrack=function(e,t){var r=t.kind,n=(e.media||[]).find(function(e){return e.type===r});if(!n)throw new Error("m="+r+" section not found");var o=void 0,a=void 0,i=void 0;if(!(n.ssrcs||[]).find(function(e){return"msid"===e.attribute&&(e.value.split(" ")[1]===t.id?(o=e.id,i=e.value.split(" ")[0],!0):void 0)}))throw new Error("a=ssrc line not found for local track [track.id:"+t.id+"]");(n.ssrcGroups||[]).some(function(e){if("FID"===e.semantics){var t=e.ssrcs.split(/\s+/);return Number(t[0])===o?(a=Number(t[1]),!0):void 0}});var s=n.ssrcs.find(function(e){return"cname"===e.attribute&&e.id===o});if(!s)throw new Error("CNAME line not found for local track [track.id:"+t.id+"]");var c=s.value,u=o+1,d=o+2;if(n.ssrcGroups=n.ssrcGroups||[],n.ssrcGroups.push({semantics:"SIM",ssrcs:o+" "+u+" "+d}),n.ssrcs.push({id:u,attribute:"cname",value:c}),n.ssrcs.push({id:u,attribute:"msid",value:i+" "+t.id}),n.ssrcs.push({id:d,attribute:"cname",value:c}),n.ssrcs.push({id:d,attribute:"msid",value:i+" "+t.id}),a){var l=a+1,p=a+2;n.ssrcGroups.push({semantics:"FID",ssrcs:u+" "+l}),n.ssrcs.push({id:l,attribute:"cname",value:c}),n.ssrcs.push({id:l,attribute:"msid",value:i+" "+t.id}),n.ssrcGroups.push({semantics:"FID",ssrcs:d+" "+p}),n.ssrcs.push({id:p,attribute:"cname",value:c}),n.ssrcs.push({id:p,attribute:"msid",value:i+" "+t.id})}}},{}],20:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.fillRtpParametersForTrack=function(e,t,r){var n=r.kind,o={cname:null,reducedSize:!0,mux:!0},a=(t.media||[]).find(function(e){if(e.type===n){var t=e.msid;if(t)return t.split(" ")[1]===r.id||void 0}});if(!a)throw new Error("m="+n+" section not found");var i=(a.ssrcs||[]).find(function(e){return"cname"===e.attribute}),s=void 0;i&&(s=i.id,o.cname=i.value);var c=[],u=!0,d=!1,l=void 0;try{for(var p,f=(a.rids||[])[Symbol.iterator]();!(u=(p=f.next()).done);u=!0){var m=p.value;"send"===m.direction&&(/^low/.test(m.id)?c.push({rid:m.id,profile:"low"}):/^medium/.test(m.id)&&c.push({rid:m.id,profile:"medium"}),/^high/.test(m.id)&&c.push({rid:m.id,profile:"high"}))}}catch(e){d=!0,l=e}finally{try{!u&&f.return&&f.return()}finally{if(d)throw l}}if(e.rtcp=o,e.encodings=[],0===c.length){var h={ssrc:s};e.encodings.push(h)}else{var v=!0,y=!1,_=void 0;try{for(var g,b=c[Symbol.iterator]();!(v=(g=b.next()).done);v=!0){var w=g.value,P={encodingId:w.rid,profile:w.profile};e.encodings.push(P)}}catch(e){y=!0,_=e}finally{try{!v&&b.return&&b.return()}finally{if(y)throw _}}}}},{}],21:[function(e,t,r){"use strict";function n(e){return e&&e.__esModule?e:{default:e}}Object.defineProperty(r,"__esModule",{value:!0}),r.Room=void 0,r.isDeviceSupported=function(){return o.default.isSupported()},r.getDeviceInfo=function(){return{flag:o.default.flag,name:o.default.name,version:o.default.version,bowser:o.default.bowser}};var o=n(e("./Device")),a=n(e("./Room"));r.Room=a.default},{"./Device":3,"./Room":8}],22:[function(e,t,r){"use strict";function n(e,t){var r=e.mimeType.toLowerCase();return r===t.mimeType.toLowerCase()&&(e.clockRate===t.clockRate&&(e.channels===t.channels&&("video/h264"!==r||((e.parameters||{})["packetization-mode"]||0)===((t.parameters||{})["packetization-mode"]||0))))}function o(e,t){return(!e.kind||!t.kind||e.kind===t.kind)&&e.uri===t.uri}function a(e,t){var r=[],n=!0,o=!1,a=void 0;try{for(var i,s=(e.rtcpFeedback||[])[Symbol.iterator]();!(n=(i=s.next()).done);n=!0)!function(e){var n=(t.rtcpFeedback||[]).find(function(t){return t.type===e.type&&t.parameter===e.parameter});n&&r.push(n)}(i.value)}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}return r}Object.defineProperty(r,"__esModule",{value:!0}),r.getExtendedRtpCapabilities=function(e,t){var r={codecs:[],headerExtensions:[],fecMechanisms:[]},i=!0,s=!1,c=void 0;try{for(var u,d=(t.codecs||[])[Symbol.iterator]();!(i=(u=d.next()).done);i=!0)!function(t){if("rtx"===t.name)return"continue";var o=(e.codecs||[]).find(function(e){return n(e,t)});if(o){var i={name:t.name,mimeType:t.mimeType,kind:t.kind,clockRate:t.clockRate,sendPayloadType:o.preferredPayloadType,sendRtxPayloadType:null,recvPayloadType:t.preferredPayloadType,recvRtxPayloadType:null,channels:t.channels,rtcpFeedback:a(o,t),parameters:t.parameters};i.channels||delete i.channels,r.codecs.push(i)}}(u.value)}catch(e){s=!0,c=e}finally{try{!i&&d.return&&d.return()}finally{if(s)throw c}}var l=!0,p=!1,f=void 0;try{for(var m,h=(r.codecs||[])[Symbol.iterator]();!(l=(m=h.next()).done);l=!0)!function(r){var n=(e.codecs||[]).find(function(e){return"rtx"===e.name&&e.parameters.apt===r.sendPayloadType}),o=(t.codecs||[]).find(function(e){return"rtx"===e.name&&e.parameters.apt===r.recvPayloadType});n&&o&&(r.sendRtxPayloadType=n.preferredPayloadType,r.recvRtxPayloadType=o.preferredPayloadType)}(m.value)}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}var v=!0,y=!1,_=void 0;try{for(var g,b=(t.headerExtensions||[])[Symbol.iterator]();!(v=(g=b.next()).done);v=!0)!function(t){var n=(e.headerExtensions||[]).find(function(e){return o(e,t)});if(n){var a={kind:t.kind,uri:t.uri,sendId:n.preferredId,recvId:t.preferredId};r.headerExtensions.push(a)}}(g.value)}catch(e){y=!0,_=e}finally{try{!v&&b.return&&b.return()}finally{if(y)throw _}}return r},r.getRtpCapabilities=function(e){var t={codecs:[],headerExtensions:[],fecMechanisms:[]},r=!0,n=!1,o=void 0;try{for(var a,i=e.codecs[Symbol.iterator]();!(r=(a=i.next()).done);r=!0){var s=a.value,c={name:s.name,mimeType:s.mimeType,kind:s.kind,clockRate:s.clockRate,preferredPayloadType:s.recvPayloadType,channels:s.channels,rtcpFeedback:s.rtcpFeedback,parameters:s.parameters};if(c.channels||delete c.channels,t.codecs.push(c),s.recvRtxPayloadType){var u={name:"rtx",mimeType:s.kind+"/rtx",kind:s.kind,clockRate:s.clockRate,preferredPayloadType:s.recvRtxPayloadType,parameters:{apt:s.recvPayloadType}};t.codecs.push(u)}}}catch(e){n=!0,o=e}finally{try{!r&&i.return&&i.return()}finally{if(n)throw o}}var d=!0,l=!1,p=void 0;try{for(var f,m=e.headerExtensions[Symbol.iterator]();!(d=(f=m.next()).done);d=!0){var h=f.value,v={kind:h.kind,uri:h.uri,preferredId:h.recvId};t.headerExtensions.push(v)}}catch(e){l=!0,p=e}finally{try{!d&&m.return&&m.return()}finally{if(l)throw p}}return t.fecMechanisms=e.fecMechanisms,t},r.getUnsupportedCodecs=function(e,t,r){if(!Array.isArray(t))return[];var n=[],o=e.codecs,a=r.codecs,i=!0,s=!1,c=void 0;try{for(var u,d=t[Symbol.iterator]();!(i=(u=d.next()).done);i=!0)!function(e){if(!a.some(function(t){return t.recvPayloadType===e})){var t=o.find(function(t){return t.preferredPayloadType===e});if(!t)throw new Error("mandatory codec PT "+e+" not found in remote codecs");n.push(t)}}(u.value)}catch(e){s=!0,c=e}finally{try{!i&&d.return&&d.return()}finally{if(s)throw c}}return n},r.canSend=function(e,t){return t.codecs.some(function(t){return t.kind===e})},r.canReceive=function(e,t){if(0===e.codecs.length)return!1;var r=e.codecs[0];return t.codecs.some(function(e){return e.recvPayloadType===r.payloadType})},r.getSendingRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,o=!1,a=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;if(c.kind===e){var u={name:c.name,mimeType:c.mimeType,clockRate:c.clockRate,payloadType:c.sendPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(u.channels||delete u.channels,r.codecs.push(u),c.sendRtxPayloadType){var d={name:"rtx",mimeType:c.kind+"/rtx",clockRate:c.clockRate,payloadType:c.sendRtxPayloadType,parameters:{apt:c.sendPayloadType}};r.codecs.push(d)}break}}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}var l=!0,p=!1,f=void 0;try{for(var m,h=t.headerExtensions[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){var v=m.value;if(!v.kind||v.kind===e){var y={uri:v.uri,id:v.sendId};r.headerExtensions.push(y)}}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}return r},r.getReceivingFullRtpParameters=function(e,t){var r={muxId:null,codecs:[],headerExtensions:[],encodings:[],rtcp:{}},n=!0,o=!1,a=void 0;try{for(var i,s=t.codecs[Symbol.iterator]();!(n=(i=s.next()).done);n=!0){var c=i.value;if(c.kind===e){var u={name:c.name,mimeType:c.mimeType,clockRate:c.clockRate,payloadType:c.recvPayloadType,channels:c.channels,rtcpFeedback:c.rtcpFeedback,parameters:c.parameters};if(u.channels||delete u.channels,r.codecs.push(u),c.recvRtxPayloadType){var d={name:"rtx",mimeType:c.kind+"/rtx",clockRate:c.clockRate,payloadType:c.recvRtxPayloadType,parameters:{apt:c.recvPayloadType}};r.codecs.push(d)}}}}catch(e){o=!0,a=e}finally{try{!n&&s.return&&s.return()}finally{if(o)throw a}}var l=!0,p=!1,f=void 0;try{for(var m,h=t.headerExtensions[Symbol.iterator]();!(l=(m=h.next()).done);l=!0){var v=m.value;if(!v.kind||v.kind===e){var y={uri:v.uri,id:v.recvId};r.headerExtensions.push(y)}}}catch(e){p=!0,f=e}finally{try{!l&&h.return&&h.return()}finally{if(p)throw f}}return r}},{}],23:[function(e,t,r){"use strict";Object.defineProperty(r,"__esModule",{value:!0}),r.randomNumber=function(){return n()},r.clone=function(e){return JSON.parse(JSON.stringify(e))};var n=function(e){return e&&e.__esModule?e:{default:e}}(e("random-number")).default.generator({min:1e7,max:99999999,integer:!0})},{"random-number":30}],24:[function(e,t,r){!function(e,r,n){void 0!==t&&t.exports?t.exports=n():e.bowser=n()}(this,0,function(){function e(e){function t(t){var r=e.match(t);return r&&r.length>1&&r[1]||""}function r(t){var r=e.match(t);return r&&r.length>1&&r[2]||""}var n,o=t(/(ipod|iphone|ipad)/i).toLowerCase(),i=!/like android/i.test(e)&&/android/i.test(e),s=/nexus\s*[0-6]\s*/i.test(e),c=!s&&/nexus\s*[0-9]+/i.test(e),u=/CrOS/.test(e),d=/silk/i.test(e),l=/sailfish/i.test(e),p=/tizen/i.test(e),f=/(web|hpw)os/i.test(e),m=/windows phone/i.test(e),h=(/SamsungBrowser/i.test(e),!m&&/windows/i.test(e)),v=!o&&!d&&/macintosh/i.test(e),y=!i&&!l&&!p&&!f&&/linux/i.test(e),_=r(/edg([ea]|ios)\/(\d+(\.\d+)?)/i),g=t(/version\/(\d+(\.\d+)?)/i),b=/tablet/i.test(e)&&!/tablet pc/i.test(e),w=!b&&/[^-]mobi/i.test(e),P=/xbox/i.test(e);/opera/i.test(e)?n={name:"Opera",opera:a,version:g||t(/(?:opera|opr|opios)[\s\/](\d+(\.\d+)?)/i)}:/opr\/|opios/i.test(e)?n={name:"Opera",opera:a,version:t(/(?:opr|opios)[\s\/](\d+(\.\d+)?)/i)||g}:/SamsungBrowser/i.test(e)?n={name:"Samsung Internet for Android",samsungBrowser:a,version:g||t(/(?:SamsungBrowser)[\s\/](\d+(\.\d+)?)/i)}:/coast/i.test(e)?n={name:"Opera Coast",coast:a,version:g||t(/(?:coast)[\s\/](\d+(\.\d+)?)/i)}:/yabrowser/i.test(e)?n={name:"Yandex Browser",yandexbrowser:a,version:g||t(/(?:yabrowser)[\s\/](\d+(\.\d+)?)/i)}:/ucbrowser/i.test(e)?n={name:"UC Browser",ucbrowser:a,version:t(/(?:ucbrowser)[\s\/](\d+(?:\.\d+)+)/i)}:/mxios/i.test(e)?n={name:"Maxthon",maxthon:a,version:t(/(?:mxios)[\s\/](\d+(?:\.\d+)+)/i)}:/epiphany/i.test(e)?n={name:"Epiphany",epiphany:a,version:t(/(?:epiphany)[\s\/](\d+(?:\.\d+)+)/i)}:/puffin/i.test(e)?n={name:"Puffin",puffin:a,version:t(/(?:puffin)[\s\/](\d+(?:\.\d+)?)/i)}:/sleipnir/i.test(e)?n={name:"Sleipnir",sleipnir:a,version:t(/(?:sleipnir)[\s\/](\d+(?:\.\d+)+)/i)}:/k-meleon/i.test(e)?n={name:"K-Meleon",kMeleon:a,version:t(/(?:k-meleon)[\s\/](\d+(?:\.\d+)+)/i)}:m?(n={name:"Windows Phone",osname:"Windows Phone",windowsphone:a},_?(n.msedge=a,n.version=_):(n.msie=a,n.version=t(/iemobile\/(\d+(\.\d+)?)/i))):/msie|trident/i.test(e)?n={name:"Internet Explorer",msie:a,version:t(/(?:msie |rv:)(\d+(\.\d+)?)/i)}:u?n={name:"Chrome",osname:"Chrome OS",chromeos:a,chromeBook:a,chrome:a,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:/edg([ea]|ios)/i.test(e)?n={name:"Microsoft Edge",msedge:a,version:_}:/vivaldi/i.test(e)?n={name:"Vivaldi",vivaldi:a,version:t(/vivaldi\/(\d+(\.\d+)?)/i)||g}:l?n={name:"Sailfish",osname:"Sailfish OS",sailfish:a,version:t(/sailfish\s?browser\/(\d+(\.\d+)?)/i)}:/seamonkey\//i.test(e)?n={name:"SeaMonkey",seamonkey:a,version:t(/seamonkey\/(\d+(\.\d+)?)/i)}:/firefox|iceweasel|fxios/i.test(e)?(n={name:"Firefox",firefox:a,version:t(/(?:firefox|iceweasel|fxios)[ \/](\d+(\.\d+)?)/i)},/\((mobile|tablet);[^\)]*rv:[\d\.]+\)/i.test(e)&&(n.firefoxos=a,n.osname="Firefox OS")):d?n={name:"Amazon Silk",silk:a,version:t(/silk\/(\d+(\.\d+)?)/i)}:/phantom/i.test(e)?n={name:"PhantomJS",phantom:a,version:t(/phantomjs\/(\d+(\.\d+)?)/i)}:/slimerjs/i.test(e)?n={name:"SlimerJS",slimer:a,version:t(/slimerjs\/(\d+(\.\d+)?)/i)}:/blackberry|\bbb\d+/i.test(e)||/rim\stablet/i.test(e)?n={name:"BlackBerry",osname:"BlackBerry OS",blackberry:a,version:g||t(/blackberry[\d]+\/(\d+(\.\d+)?)/i)}:f?(n={name:"WebOS",osname:"WebOS",webos:a,version:g||t(/w(?:eb)?osbrowser\/(\d+(\.\d+)?)/i)},/touchpad\//i.test(e)&&(n.touchpad=a)):/bada/i.test(e)?n={name:"Bada",osname:"Bada",bada:a,version:t(/dolfin\/(\d+(\.\d+)?)/i)}:p?n={name:"Tizen",osname:"Tizen",tizen:a,version:t(/(?:tizen\s?)?browser\/(\d+(\.\d+)?)/i)||g}:/qupzilla/i.test(e)?n={name:"QupZilla",qupzilla:a,version:t(/(?:qupzilla)[\s\/](\d+(?:\.\d+)+)/i)||g}:/chromium/i.test(e)?n={name:"Chromium",chromium:a,version:t(/(?:chromium)[\s\/](\d+(?:\.\d+)?)/i)||g}:/chrome|crios|crmo/i.test(e)?n={name:"Chrome",chrome:a,version:t(/(?:chrome|crios|crmo)\/(\d+(\.\d+)?)/i)}:i?n={name:"Android",version:g}:/safari|applewebkit/i.test(e)?(n={name:"Safari",safari:a},g&&(n.version=g)):o?(n={name:"iphone"==o?"iPhone":"ipad"==o?"iPad":"iPod"},g&&(n.version=g)):n=/googlebot/i.test(e)?{name:"Googlebot",googlebot:a,version:t(/googlebot\/(\d+(\.\d+))/i)||g}:{name:t(/^(.*)\/(.*) /),version:r(/^(.*)\/(.*) /)},!n.msedge&&/(apple)?webkit/i.test(e)?(/(apple)?webkit\/537\.36/i.test(e)?(n.name=n.name||"Blink",n.blink=a):(n.name=n.name||"Webkit",n.webkit=a),!n.version&&g&&(n.version=g)):!n.opera&&/gecko\//i.test(e)&&(n.name=n.name||"Gecko",n.gecko=a,n.version=n.version||t(/gecko\/(\d+(\.\d+)?)/i)),n.windowsphone||!i&&!n.silk?!n.windowsphone&&o?(n[o]=a,n.ios=a,n.osname="iOS"):v?(n.mac=a,n.osname="macOS"):P?(n.xbox=a,n.osname="Xbox"):h?(n.windows=a,n.osname="Windows"):y&&(n.linux=a,n.osname="Linux"):(n.android=a,n.osname="Android");var k="";n.windows?k=function(e){switch(e){case"NT":return"NT";case"XP":return"XP";case"NT 5.0":return"2000";case"NT 5.1":return"XP";case"NT 5.2":return"2003";case"NT 6.0":return"Vista";case"NT 6.1":return"7";case"NT 6.2":return"8";case"NT 6.3":return"8.1";case"NT 10.0":return"10";default:return}}(t(/Windows ((NT|XP)( \d\d?.\d)?)/i)):n.windowsphone?k=t(/windows phone (?:os)?\s?(\d+(\.\d+)*)/i):n.mac?k=(k=t(/Mac OS X (\d+([_\.\s]\d+)*)/i)).replace(/[_\s]/g,"."):o?k=(k=t(/os (\d+([_\s]\d+)*) like mac os x/i)).replace(/[_\s]/g,"."):i?k=t(/android[ \/-](\d+(\.\d+)*)/i):n.webos?k=t(/(?:web|hpw)os\/(\d+(\.\d+)*)/i):n.blackberry?k=t(/rim\stablet\sos\s(\d+(\.\d+)*)/i):n.bada?k=t(/bada\/(\d+(\.\d+)*)/i):n.tizen&&(k=t(/tizen[\/\s](\d+(\.\d+)*)/i)),k&&(n.osversion=k);var S=!n.windows&&k.split(".")[0];return b||c||"ipad"==o||i&&(3==S||S>=4&&!w)||n.silk?n.tablet=a:(w||"iphone"==o||"ipod"==o||i||s||n.blackberry||n.webos||n.bada)&&(n.mobile=a),n.msedge||n.msie&&n.version>=10||n.yandexbrowser&&n.version>=15||n.vivaldi&&n.version>=1||n.chrome&&n.version>=20||n.samsungBrowser&&n.version>=4||n.firefox&&n.version>=20||n.safari&&n.version>=6||n.opera&&n.version>=10||n.ios&&n.osversion&&n.osversion.split(".")[0]>=6||n.blackberry&&n.version>=10.1||n.chromium&&n.version>=20?n.a=a:n.msie&&n.version<10||n.chrome&&n.version<20||n.firefox&&n.version<20||n.safari&&n.version<6||n.opera&&n.version<10||n.ios&&n.osversion&&n.osversion.split(".")[0]<6||n.chromium&&n.version<20?n.c=a:n.x=a,n}function t(e){return e.split(".").length}function r(e,t){var r,n=[];if(Array.prototype.map)return Array.prototype.map.call(e,t);for(r=0;r<e.length;r++)n.push(t(e[r]));return n}function n(e){for(var n=Math.max(t(e[0]),t(e[1])),o=r(e,function(e){var o=n-t(e);return e+=new Array(o+1).join(".0"),r(e.split("."),function(e){return new Array(20-e.length).join("0")+e}).reverse()});--n>=0;){if(o[0][n]>o[1][n])return 1;if(o[0][n]!==o[1][n])return-1;if(0===n)return 0}}function o(t,r,o){var a=i;"string"==typeof r&&(o=r,r=void 0),void 0===r&&(r=!1),o&&(a=e(o));var s=""+a.version;for(var c in t)if(t.hasOwnProperty(c)&&a[c]){if("string"!=typeof t[c])throw new Error("Browser version in the minVersion map should be a string: "+c+": "+String(t));return n([s,t[c]])<0}return r}var a=!0,i=e("undefined"!=typeof navigator?navigator.userAgent||"":"");return i.test=function(e){for(var t=0;t<e.length;++t){var r=e[t];if("string"==typeof r&&r in i)return!0}return!1},i.isUnsupportedBrowser=o,i.compareVersions=n,i.check=function(e,t,r){return!o(e,t,r)},i._detect=e,i})},{}],25:[function(e,t,r){(function(n){function o(){var e;try{e=r.storage.debug}catch(e){}return!e&&void 0!==n&&"env"in n&&(e=n.env.DEBUG),e}(r=t.exports=e("./debug")).log=function(){return"object"==typeof console&&console.log&&Function.prototype.apply.call(console.log,console,arguments)},r.formatArgs=function(e){var t=this.useColors;if(e[0]=(t?"%c":"")+this.namespace+(t?" %c":" ")+e[0]+(t?"%c ":" ")+"+"+r.humanize(this.diff),t){var n="color: "+this.color;e.splice(1,0,n,"color: inherit");var o=0,a=0;e[0].replace(/%[a-zA-Z%]/g,function(e){"%%"!==e&&(o++,"%c"===e&&(a=o))}),e.splice(a,0,n)}},r.save=function(e){try{null==e?r.storage.removeItem("debug"):r.storage.debug=e}catch(e){}},r.load=o,r.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},r.storage="undefined"!=typeof chrome&&void 0!==chrome.storage?chrome.storage.local:function(){try{return window.localStorage}catch(e){}}(),r.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],r.formatters.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}},r.enable(o())}).call(this,e("_process"))},{"./debug":26,_process:29}],26:[function(e,t,r){function n(e){var t,n=0;for(t in e)n=(n<<5)-n+e.charCodeAt(t),n|=0;return r.colors[Math.abs(n)%r.colors.length]}function o(e){function t(){if(t.enabled){var e=t,n=+new Date,a=n-(o||n);e.diff=a,e.prev=o,e.curr=n,o=n;for(var i=new Array(arguments.length),s=0;s<i.length;s++)i[s]=arguments[s];i[0]=r.coerce(i[0]),"string"!=typeof i[0]&&i.unshift("%O");var c=0;i[0]=i[0].replace(/%([a-zA-Z%])/g,function(t,n){if("%%"===t)return t;c++;var o=r.formatters[n];if("function"==typeof o){var a=i[c];t=o.call(e,a),i.splice(c,1),c--}return t}),r.formatArgs.call(e,i),(t.log||r.log||console.log.bind(console)).apply(e,i)}}var o;return t.namespace=e,t.enabled=r.enabled(e),t.useColors=r.useColors(),t.color=n(e),t.destroy=a,"function"==typeof r.init&&r.init(t),r.instances.push(t),t}function a(){var e=r.instances.indexOf(this);return-1!==e&&(r.instances.splice(e,1),!0)}(r=t.exports=o.debug=o.default=o).coerce=function(e){return e instanceof Error?e.stack||e.message:e},r.disable=function(){r.enable("")},r.enable=function(e){r.save(e),r.names=[],r.skips=[];var t,n=("string"==typeof e?e:"").split(/[\s,]+/),o=n.length;for(t=0;t<o;t++)n[t]&&("-"===(e=n[t].replace(/\*/g,".*?"))[0]?r.skips.push(new RegExp("^"+e.substr(1)+"$")):r.names.push(new RegExp("^"+e+"$")));for(t=0;t<r.instances.length;t++){var a=r.instances[t];a.enabled=r.enabled(a.namespace)}},r.enabled=function(e){if("*"===e[e.length-1])return!0;var t,n;for(t=0,n=r.skips.length;t<n;t++)if(r.skips[t].test(e))return!1;for(t=0,n=r.names.length;t<n;t++)if(r.names[t].test(e))return!0;return!1},r.humanize=e("ms"),r.instances=[],r.names=[],r.skips=[],r.formatters={}},{ms:28}],27:[function(e,t,r){function n(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function o(e){return"function"==typeof e}function a(e){return"number"==typeof e}function i(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}t.exports=n,n.EventEmitter=n,n.prototype._events=void 0,n.prototype._maxListeners=void 0,n.defaultMaxListeners=10,n.prototype.setMaxListeners=function(e){if(!a(e)||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},n.prototype.emit=function(e){var t,r,n,a,c,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||i(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var d=new Error('Uncaught, unspecified "error" event. ('+t+")");throw d.context=t,d}if(r=this._events[e],s(r))return!1;if(o(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:a=Array.prototype.slice.call(arguments,1),r.apply(this,a)}else if(i(r))for(a=Array.prototype.slice.call(arguments,1),n=(u=r.slice()).length,c=0;c<n;c++)u[c].apply(this,a);return!0},n.prototype.addListener=function(e,t){var r;if(!o(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,o(t.listener)?t.listener:t),this._events[e]?i(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,i(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?n.defaultMaxListeners:this._maxListeners)&&r>0&&this._events[e].length>r&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),"function"==typeof console.trace&&console.trace()),this},n.prototype.on=n.prototype.addListener,n.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!o(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},n.prototype.removeListener=function(e,t){var r,n,a,s;if(!o(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],a=r.length,n=-1,r===t||o(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(i(r)){for(s=a;s-- >0;)if(r[s]===t||r[s].listener&&r[s].listener===t){n=s;break}if(n<0)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},n.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],o(r))this.removeListener(e,r);else if(r)for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},n.prototype.listeners=function(e){return this._events&&this._events[e]?o(this._events[e])?[this._events[e]]:this._events[e].slice():[]},n.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(o(t))return 1;if(t)return t.length}return 0},n.listenerCount=function(e,t){return e.listenerCount(t)}},{}],28:[function(e,t,r){function n(e){if(!((e=String(e)).length>100)){var t=/^((?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|years?|yrs?|y)?$/i.exec(e);if(t){var r=parseFloat(t[1]);switch((t[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return r*l;case"days":case"day":case"d":return r*d;case"hours":case"hour":case"hrs":case"hr":case"h":return r*u;case"minutes":case"minute":case"mins":case"min":case"m":return r*c;case"seconds":case"second":case"secs":case"sec":case"s":return r*s;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return r;default:return}}}}function o(e){return e>=d?Math.round(e/d)+"d":e>=u?Math.round(e/u)+"h":e>=c?Math.round(e/c)+"m":e>=s?Math.round(e/s)+"s":e+"ms"}function a(e){return i(e,d,"day")||i(e,u,"hour")||i(e,c,"minute")||i(e,s,"second")||e+" ms"}function i(e,t,r){if(!(e<t))return e<1.5*t?Math.floor(e/t)+" "+r:Math.ceil(e/t)+" "+r+"s"}var s=1e3,c=60*s,u=60*c,d=24*u,l=365.25*d;t.exports=function(e,t){t=t||{};var r=typeof e;if("string"===r&&e.length>0)return n(e);if("number"===r&&!1===isNaN(e))return t.long?a(e):o(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},{}],29:[function(e,t,r){function n(){throw new Error("setTimeout has not been defined")}function o(){throw new Error("clearTimeout has not been defined")}function a(e){if(l===setTimeout)return setTimeout(e,0);if((l===n||!l)&&setTimeout)return l=setTimeout,setTimeout(e,0);try{return l(e,0)}catch(t){try{return l.call(null,e,0)}catch(t){return l.call(this,e,0)}}}function i(e){if(p===clearTimeout)return clearTimeout(e);if((p===o||!p)&&clearTimeout)return p=clearTimeout,clearTimeout(e);try{return p(e)}catch(t){try{return p.call(null,e)}catch(t){return p.call(this,e)}}}function s(){v&&m&&(v=!1,m.length?h=m.concat(h):y=-1,h.length&&c())}function c(){if(!v){var e=a(s);v=!0;for(var t=h.length;t;){for(m=h,h=[];++y<t;)m&&m[y].run();y=-1,t=h.length}m=null,v=!1,i(e)}}function u(e,t){this.fun=e,this.array=t}function d(){}var l,p,f=t.exports={};!function(){try{l="function"==typeof setTimeout?setTimeout:n}catch(e){l=n}try{p="function"==typeof clearTimeout?clearTimeout:o}catch(e){p=o}}();var m,h=[],v=!1,y=-1;f.nextTick=function(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)t[r-1]=arguments[r];h.push(new u(e,t)),1!==h.length||v||a(c)},u.prototype.run=function(){this.fun.apply(null,this.array)},f.title="browser",f.browser=!0,f.env={},f.argv=[],f.version="",f.versions={},f.on=d,f.addListener=d,f.once=d,f.off=d,f.removeListener=d,f.removeAllListeners=d,f.emit=d,f.prependListener=d,f.prependOnceListener=d,f.listeners=function(e){return[]},f.binding=function(e){throw new Error("process.binding is not supported")},f.cwd=function(){return"/"},f.chdir=function(e){throw new Error("process.chdir is not supported")},f.umask=function(){return 0}},{}],30:[function(e,t,r){!function(e){function r(e){var t=(e=e||{}).min,r=e.max,n=e.integer||!1;if(null==t&&null==r?(t=0,r=1):null==t?t=r-1:null==r&&(r=t+1),r<t)throw new Error("invalid options, max must be >= min");return{min:t,max:r,integer:n}}function n(e){if((e=r(e)).max===e.min)return e.min;var t=Math.random()*(e.max-e.min+Number(!!e.integer))+e.min;return e.integer?Math.floor(t):t}t.exports=n,t.exports.generator=function(e){return e=r(e),function(t,r,o){return e.min=null!=t?t:e.min,e.max=null!=r?r:e.max,e.integer=null!=o?o:e.integer,n(e)}},t.exports.defaults=r}()},{}],31:[function(e,t,r){var n=t.exports={v:[{name:"version",reg:/^(\d*)$/}],o:[{name:"origin",reg:/^(\S*) (\d*) (\d*) (\S*) IP(\d) (\S*)/,names:["username","sessionId","sessionVersion","netType","ipVer","address"],format:"%s %s %d %s IP%d %s"}],s:[{name:"name"}],i:[{name:"description"}],u:[{name:"uri"}],e:[{name:"email"}],p:[{name:"phone"}],z:[{name:"timezones"}],r:[{name:"repeats"}],t:[{name:"timing",reg:/^(\d*) (\d*)/,names:["start","stop"],format:"%d %d"}],c:[{name:"connection",reg:/^IN IP(\d) (\S*)/,names:["version","ip"],format:"IN IP%d %s"}],b:[{push:"bandwidth",reg:/^(TIAS|AS|CT|RR|RS):(\d*)/,names:["type","limit"],format:"%s:%s"}],m:[{reg:/^(\w*) (\d*) ([\w\/]*)(?: (.*))?/,names:["type","port","protocol","payloads"],format:"%s %d %s %s"}],a:[{push:"rtp",reg:/^rtpmap:(\d*) ([\w\-\.]*)(?:\s*\/(\d*)(?:\s*\/(\S*))?)?/,names:["payload","codec","rate","encoding"],format:function(e){return e.encoding?"rtpmap:%d %s/%s/%s":e.rate?"rtpmap:%d %s/%s":"rtpmap:%d %s"}},{push:"fmtp",reg:/^fmtp:(\d*) ([\S| ]*)/,names:["payload","config"],format:"fmtp:%d %s"},{name:"control",reg:/^control:(.*)/,format:"control:%s"},{name:"rtcp",reg:/^rtcp:(\d*)(?: (\S*) IP(\d) (\S*))?/,names:["port","netType","ipVer","address"],format:function(e){return null!=e.address?"rtcp:%d %s IP%d %s":"rtcp:%d"}},{push:"rtcpFbTrrInt",reg:/^rtcp-fb:(\*|\d*) trr-int (\d*)/,names:["payload","value"],format:"rtcp-fb:%d trr-int %d"},{push:"rtcpFb",reg:/^rtcp-fb:(\*|\d*) ([\w-_]*)(?: ([\w-_]*))?/,names:["payload","type","subtype"],format:function(e){return null!=e.subtype?"rtcp-fb:%s %s %s":"rtcp-fb:%s %s"}},{push:"ext",reg:/^extmap:(\d+)(?:\/(\w+))? (\S*)(?: (\S*))?/,names:["value","direction","uri","config"],format:function(e){return"extmap:%d"+(e.direction?"/%s":"%v")+" %s"+(e.config?" %s":"")}},{push:"crypto",reg:/^crypto:(\d*) ([\w_]*) (\S*)(?: (\S*))?/,names:["id","suite","config","sessionConfig"],format:function(e){return null!=e.sessionConfig?"crypto:%d %s %s %s":"crypto:%d %s %s"}},{name:"setup",reg:/^setup:(\w*)/,format:"setup:%s"},{name:"mid",reg:/^mid:([^\s]*)/,format:"mid:%s"},{name:"msid",reg:/^msid:(.*)/,format:"msid:%s"},{name:"ptime",reg:/^ptime:(\d*)/,format:"ptime:%d"},{name:"maxptime",reg:/^maxptime:(\d*)/,format:"maxptime:%d"},{name:"direction",reg:/^(sendrecv|recvonly|sendonly|inactive)/},{name:"icelite",reg:/^(ice-lite)/},{name:"iceUfrag",reg:/^ice-ufrag:(\S*)/,format:"ice-ufrag:%s"},{name:"icePwd",reg:/^ice-pwd:(\S*)/,format:"ice-pwd:%s"},{name:"fingerprint",reg:/^fingerprint:(\S*) (\S*)/,names:["type","hash"],format:"fingerprint:%s %s"},{push:"candidates",reg:/^candidate:(\S*) (\d*) (\S*) (\d*) (\S*) (\d*) typ (\S*)(?: raddr (\S*) rport (\d*))?(?: tcptype (\S*))?(?: generation (\d*))?(?: network-id (\d*))?(?: network-cost (\d*))?/,names:["foundation","component","transport","priority","ip","port","type","raddr","rport","tcptype","generation","network-id","network-cost"],format:function(e){var t="candidate:%s %d %s %d %s %d typ %s";return t+=null!=e.raddr?" raddr %s rport %d":"%v%v",t+=null!=e.tcptype?" tcptype %s":"%v",null!=e.generation&&(t+=" generation %d"),t+=null!=e["network-id"]?" network-id %d":"%v",t+=null!=e["network-cost"]?" network-cost %d":"%v"}},{name:"endOfCandidates",reg:/^(end-of-candidates)/},{name:"remoteCandidates",reg:/^remote-candidates:(.*)/,format:"remote-candidates:%s"},{name:"iceOptions",reg:/^ice-options:(\S*)/,format:"ice-options:%s"},{push:"ssrcs",reg:/^ssrc:(\d*) ([\w_]*)(?::(.*))?/,names:["id","attribute","value"],format:function(e){var t="ssrc:%d";return null!=e.attribute&&(t+=" %s",null!=e.value&&(t+=":%s")),t}},{push:"ssrcGroups",reg:/^ssrc-group:([\x21\x23\x24\x25\x26\x27\x2A\x2B\x2D\x2E\w]*) (.*)/,names:["semantics","ssrcs"],format:"ssrc-group:%s %s"},{name:"msidSemantic",reg:/^msid-semantic:\s?(\w*) (\S*)/,names:["semantic","token"],format:"msid-semantic: %s %s"},{push:"groups",reg:/^group:(\w*) (.*)/,names:["type","mids"],format:"group:%s %s"},{name:"rtcpMux",reg:/^(rtcp-mux)/},{name:"rtcpRsize",reg:/^(rtcp-rsize)/},{name:"sctpmap",reg:/^sctpmap:([\w_\/]*) (\S*)(?: (\S*))?/,names:["sctpmapNumber","app","maxMessageSize"],format:function(e){return null!=e.maxMessageSize?"sctpmap:%s %s %s":"sctpmap:%s %s"}},{name:"xGoogleFlag",reg:/^x-google-flag:([^\s]*)/,format:"x-google-flag:%s"},{push:"rids",reg:/^rid:([\d\w]+) (\w+)(?: ([\S| ]*))?/,names:["id","direction","params"],format:function(e){return e.params?"rid:%s %s %s":"rid:%s %s"}},{push:"imageattrs",reg:new RegExp("^imageattr:(\\d+|\\*)[\\s\\t]+(send|recv)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*)(?:[\\s\\t]+(recv|send)[\\s\\t]+(\\*|\\[\\S+\\](?:[\\s\\t]+\\[\\S+\\])*))?"),names:["pt","dir1","attrs1","dir2","attrs2"],format:function(e){return"imageattr:%s %s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast",reg:new RegExp("^simulcast:(send|recv) ([a-zA-Z0-9\\-_~;,]+)(?:\\s?(send|recv) ([a-zA-Z0-9\\-_~;,]+))?$"),names:["dir1","list1","dir2","list2"],format:function(e){return"simulcast:%s %s"+(e.dir2?" %s %s":"")}},{name:"simulcast_03",reg:/^simulcast:[\s\t]+([\S+\s\t]+)$/,names:["value"],format:"simulcast: %s"},{name:"framerate",reg:/^framerate:(\d+(?:$|\.\d+))/,format:"framerate:%s"},{push:"invalid",names:["value"]}]};Object.keys(n).forEach(function(e){n[e].forEach(function(e){e.reg||(e.reg=/(.*)/),e.format||(e.format="%s")})})},{}],32:[function(e,t,r){var n=e("./parser"),o=e("./writer");r.write=o,r.parse=n.parse,r.parseFmtpConfig=n.parseFmtpConfig,r.parseParams=n.parseParams,r.parsePayloads=n.parsePayloads,r.parseRemoteCandidates=n.parseRemoteCandidates,r.parseImageAttributes=n.parseImageAttributes,r.parseSimulcastStreamList=n.parseSimulcastStreamList},{"./parser":33,"./writer":34}],33:[function(e,t,r){var n=function(e){return String(Number(e))===e?Number(e):e},o=function(e,t,r,o){if(o&&!r)t[o]=n(e[1]);else for(var a=0;a<r.length;a+=1)null!=e[a+1]&&(t[r[a]]=n(e[a+1]))},a=function(e,t,r){var n=e.name&&e.names;e.push&&!t[e.push]?t[e.push]=[]:n&&!t[e.name]&&(t[e.name]={});var a=e.push?{}:n?t[e.name]:t;o(r.match(e.reg),a,e.names,e.name),e.push&&t[e.push].push(a)},i=e("./grammar"),s=RegExp.prototype.test.bind(/^([a-z])=(.*)/);r.parse=function(e){var t={},r=[],n=t;return e.split(/(\r\n|\r|\n)/).filter(s).forEach(function(e){var t=e[0],o=e.slice(2);"m"===t&&(r.push({rtp:[],fmtp:[]}),n=r[r.length-1]);for(var s=0;s<(i[t]||[]).length;s+=1){var c=i[t][s];if(c.reg.test(o))return a(c,n,o)}}),t.media=r,t};var c=function(e,t){var r=t.split(/=(.+)/,2);return 2===r.length&&(e[r[0]]=n(r[1])),e};r.parseParams=function(e){return e.split(/\;\s?/).reduce(c,{})},r.parseFmtpConfig=r.parseParams,r.parsePayloads=function(e){return e.split(" ").map(Number)},r.parseRemoteCandidates=function(e){for(var t=[],r=e.split(" ").map(n),o=0;o<r.length;o+=3)t.push({component:r[o],ip:r[o+1],port:r[o+2]});return t},r.parseImageAttributes=function(e){return e.split(" ").map(function(e){return e.substring(1,e.length-1).split(",").reduce(c,{})})},r.parseSimulcastStreamList=function(e){return e.split(";").map(function(e){return e.split(",").map(function(e){var t,r=!1;return"~"!==e[0]?t=n(e):(t=n(e.substring(1,e.length)),r=!0),{scid:t,paused:r}})})}},{"./grammar":31}],34:[function(e,t,r){var n=e("./grammar"),o=/%[sdv%]/g,a=function(e){var t=1,r=arguments,n=r.length;return e.replace(o,function(e){if(t>=n)return e;var o=r[t];switch(t+=1,e){case"%%":return"%";case"%s":return String(o);case"%d":return Number(o);case"%v":return""}})},i=function(e,t,r){var n=[e+"="+(t.format instanceof Function?t.format(t.push?r:r[t.name]):t.format)];if(t.names)for(var o=0;o<t.names.length;o+=1){var i=t.names[o];t.name?n.push(r[t.name][i]):n.push(r[t.names[o]])}else n.push(r[t.name]);return a.apply(null,n)},s=["v","o","s","i","u","e","p","c","b","t","r","z","a"],c=["i","c","b","a"];t.exports=function(e,t){t=t||{},null==e.version&&(e.version=0),null==e.name&&(e.name=" "),e.media.forEach(function(e){null==e.payloads&&(e.payloads="")});var r=t.outerOrder||s,o=t.innerOrder||c,a=[];return r.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?a.push(i(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){a.push(i(t,r,e))})})}),e.media.forEach(function(e){a.push(i("m",n.m[0],e)),o.forEach(function(t){n[t].forEach(function(r){r.name in e&&null!=e[r.name]?a.push(i(t,r,e)):r.push in e&&null!=e[r.push]&&e[r.push].forEach(function(e){a.push(i(t,r,e))})})})}),a.join("\r\n")+"\r\n"}},{"./grammar":31}]},{},[21])(21)});